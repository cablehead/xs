<!DOCTYPE html><html lang="en" dir="ltr" data-theme="dark" data-has-toc data-has-sidebar class="astro-bguv2lll"> <head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>TodoMVC with Datastar | cross.stream</title><link rel="canonical"/><link rel="shortcut icon" href="/xs/favicon.svg" type="image/svg+xml"/><meta name="generator" content="Astro v5.11.2"/><meta name="generator" content="Starlight v0.30.6"/><meta property="og:title" content="TodoMVC with Datastar"/><meta property="og:type" content="article"/><meta property="og:url"/><meta property="og:locale" content="en"/><meta property="og:description" content="Learn to build reactive web apps using the hypermedia approach where backend drives UI updates via immediate mode HTML streaming"/><meta property="og:site_name" content="cross.stream"/><meta name="twitter:card" content="summary_large_image"/><meta name="description" content="Learn to build reactive web apps using the hypermedia approach where backend drives UI updates via immediate mode HTML streaming"/><script>
	window.StarlightThemeProvider = (() => {
		const storedTheme =
			typeof localStorage !== 'undefined' && localStorage.getItem('starlight-theme');
		const theme =
			storedTheme ||
			(window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark');
		document.documentElement.dataset.theme = theme === 'light' ? 'light' : 'dark';
		return {
			updatePickers(theme = storedTheme || 'auto') {
				document.querySelectorAll('starlight-theme-select').forEach((picker) => {
					const select = picker.querySelector('select');
					if (select) select.value = theme;
					/** @type {HTMLTemplateElement | null} */
					const tmpl = document.querySelector(`#theme-icons`);
					const newIcon = tmpl && tmpl.content.querySelector('.' + theme);
					if (newIcon) {
						const oldIcon = picker.querySelector('svg.label-icon');
						if (oldIcon) {
							oldIcon.replaceChildren(...newIcon.cloneNode(true).childNodes);
						}
					}
				});
			},
		};
	})();
</script><template id="theme-icons"><svg aria-hidden="true" class="light astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M5 12a1 1 0 0 0-1-1H3a1 1 0 0 0 0 2h1a1 1 0 0 0 1-1Zm.64 5-.71.71a1 1 0 0 0 0 1.41 1 1 0 0 0 1.41 0l.71-.71A1 1 0 0 0 5.64 17ZM12 5a1 1 0 0 0 1-1V3a1 1 0 0 0-2 0v1a1 1 0 0 0 1 1Zm5.66 2.34a1 1 0 0 0 .7-.29l.71-.71a1 1 0 1 0-1.41-1.41l-.66.71a1 1 0 0 0 0 1.41 1 1 0 0 0 .66.29Zm-12-.29a1 1 0 0 0 1.41 0 1 1 0 0 0 0-1.41l-.71-.71a1.004 1.004 0 1 0-1.43 1.41l.73.71ZM21 11h-1a1 1 0 0 0 0 2h1a1 1 0 0 0 0-2Zm-2.64 6A1 1 0 0 0 17 18.36l.71.71a1 1 0 0 0 1.41 0 1 1 0 0 0 0-1.41l-.76-.66ZM12 6.5a5.5 5.5 0 1 0 5.5 5.5A5.51 5.51 0 0 0 12 6.5Zm0 9a3.5 3.5 0 1 1 0-7 3.5 3.5 0 0 1 0 7Zm0 3.5a1 1 0 0 0-1 1v1a1 1 0 0 0 2 0v-1a1 1 0 0 0-1-1Z"/></svg> <svg aria-hidden="true" class="dark astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.64 13a1 1 0 0 0-1.05-.14 8.049 8.049 0 0 1-3.37.73 8.15 8.15 0 0 1-8.14-8.1 8.59 8.59 0 0 1 .25-2A1 1 0 0 0 8 2.36a10.14 10.14 0 1 0 14 11.69 1 1 0 0 0-.36-1.05Zm-9.5 6.69A8.14 8.14 0 0 1 7.08 5.22v.27a10.15 10.15 0 0 0 10.14 10.14 9.784 9.784 0 0 0 2.1-.22 8.11 8.11 0 0 1-7.18 4.32v-.04Z"/></svg> <svg aria-hidden="true" class="auto astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg> </template><link rel="stylesheet" href="/xs/_astro/index.Dig0c5_E.css">
<style>:root{--sl-badge-default-border: var(--sl-color-accent);--sl-badge-default-bg: var(--sl-color-accent-low);--sl-badge-default-text: #fff;--sl-badge-note-border: var(--sl-color-blue);--sl-badge-note-bg: var(--sl-color-blue-low);--sl-badge-note-text: #fff;--sl-badge-danger-border: var(--sl-color-red);--sl-badge-danger-bg: var(--sl-color-red-low);--sl-badge-danger-text: #fff;--sl-badge-success-border: var(--sl-color-green);--sl-badge-success-bg: var(--sl-color-green-low);--sl-badge-success-text: #fff;--sl-badge-caution-border: var(--sl-color-orange);--sl-badge-caution-bg: var(--sl-color-orange-low);--sl-badge-caution-text: #fff;--sl-badge-tip-border: var(--sl-color-purple);--sl-badge-tip-bg: var(--sl-color-purple-low);--sl-badge-tip-text: #fff}[data-theme=light]:root{--sl-badge-default-bg: var(--sl-color-accent-high);--sl-badge-note-bg: var(--sl-color-blue-high);--sl-badge-danger-bg: var(--sl-color-red-high);--sl-badge-success-bg: var(--sl-color-green-high);--sl-badge-caution-bg: var(--sl-color-orange-high);--sl-badge-tip-bg: var(--sl-color-purple-high)}.sl-badge:where(.astro-avdet4wd){display:inline-block;border:1px solid var(--sl-color-border-badge);border-radius:.25rem;font-family:var(--sl-font-system-mono);line-height:normal;color:var(--sl-color-text-badge);background-color:var(--sl-color-bg-badge);overflow-wrap:anywhere}.sidebar-content .sl-badge:where(.astro-avdet4wd){line-height:1;font-size:var(--sl-text-xs);padding:.125rem .375rem}.sidebar-content a[aria-current=page]>.sl-badge:where(.astro-avdet4wd){--sl-color-bg-badge: transparent;--sl-color-border-badge: currentColor;color:inherit}.default:where(.astro-avdet4wd){--sl-color-bg-badge: var(--sl-badge-default-bg);--sl-color-border-badge: var(--sl-badge-default-border);--sl-color-text-badge: var(--sl-badge-default-text)}.note:where(.astro-avdet4wd){--sl-color-bg-badge: var(--sl-badge-note-bg);--sl-color-border-badge: var(--sl-badge-note-border);--sl-color-text-badge: var(--sl-badge-note-text)}.danger:where(.astro-avdet4wd){--sl-color-bg-badge: var(--sl-badge-danger-bg);--sl-color-border-badge: var(--sl-badge-danger-border);--sl-color-text-badge: var(--sl-badge-danger-text)}.success:where(.astro-avdet4wd){--sl-color-bg-badge: var(--sl-badge-success-bg);--sl-color-border-badge: var(--sl-badge-success-border);--sl-color-text-badge: var(--sl-badge-success-text)}.tip:where(.astro-avdet4wd){--sl-color-bg-badge: var(--sl-badge-tip-bg);--sl-color-border-badge: var(--sl-badge-tip-border);--sl-color-text-badge: var(--sl-badge-tip-text)}.caution:where(.astro-avdet4wd){--sl-color-bg-badge: var(--sl-badge-caution-bg);--sl-color-border-badge: var(--sl-badge-caution-border);--sl-color-text-badge: var(--sl-badge-caution-text)}.small:where(.astro-avdet4wd){font-size:var(--sl-text-xs);padding:.125rem .25rem}.medium:where(.astro-avdet4wd){font-size:var(--sl-text-sm);padding:.175rem .35rem}.large:where(.astro-avdet4wd){font-size:var(--sl-text-base);padding:.225rem .45rem}.sl-markdown-content :is(h1,h2,h3,h4,h5,h6) .sl-badge:where(.astro-avdet4wd){vertical-align:middle}
.card-grid:where(.astro-zntqmydn){display:grid;grid-template-columns:100%;gap:1rem}.card-grid:where(.astro-zntqmydn)>*{margin-top:0!important}@media (min-width: 50rem){.card-grid:where(.astro-zntqmydn){grid-template-columns:1fr 1fr;gap:1.5rem}.stagger:where(.astro-zntqmydn){--stagger-height: 5rem;padding-bottom:var(--stagger-height)}.stagger:where(.astro-zntqmydn)>*:nth-child(2n){transform:translateY(var(--stagger-height))}}
.card:where(.astro-v5tidmuc){--sl-card-border: var(--sl-color-purple);--sl-card-bg: var(--sl-color-purple-low);border:1px solid var(--sl-color-gray-5);background-color:var(--sl-color-black);padding:clamp(1rem,calc(.125rem + 3vw),2.5rem);flex-direction:column;gap:clamp(.5rem,calc(.125rem + 1vw),1rem)}.card:where(.astro-v5tidmuc):nth-child(4n+1){--sl-card-border: var(--sl-color-orange);--sl-card-bg: var(--sl-color-orange-low)}.card:where(.astro-v5tidmuc):nth-child(4n+3){--sl-card-border: var(--sl-color-green);--sl-card-bg: var(--sl-color-green-low)}.card:where(.astro-v5tidmuc):nth-child(4n+4){--sl-card-border: var(--sl-color-red);--sl-card-bg: var(--sl-color-red-low)}.card:where(.astro-v5tidmuc):nth-child(4n+5){--sl-card-border: var(--sl-color-blue);--sl-card-bg: var(--sl-color-blue-low)}.title:where(.astro-v5tidmuc){font-weight:600;font-size:var(--sl-text-h4);color:var(--sl-color-white);line-height:var(--sl-line-height-headings);gap:1rem;align-items:center}.card:where(.astro-v5tidmuc) .icon:where(.astro-v5tidmuc){border:1px solid var(--sl-card-border);background-color:var(--sl-card-bg);padding:.2em;border-radius:.25rem}.card:where(.astro-v5tidmuc) .body:where(.astro-v5tidmuc){margin:0;font-size:clamp(var(--sl-text-sm),calc(.5rem + 1vw),var(--sl-text-body))}
svg:where(.astro-c6vsoqas){color:var(--sl-icon-color);font-size:var(--sl-icon-size, 1em);width:1em;height:1em}
starlight-tabs:where(.astro-esqgolmp){display:block}.tablist-wrapper:where(.astro-esqgolmp){overflow-x:auto}:where(.astro-esqgolmp)[role=tablist]{display:flex;list-style:none;border-bottom:2px solid var(--sl-color-gray-5);padding:0}.tab:where(.astro-esqgolmp){margin-bottom:-2px}.tab:where(.astro-esqgolmp)>:where(.astro-esqgolmp)[role=tab]{display:flex;align-items:center;gap:.5rem;padding:0 1.25rem;text-decoration:none;border-bottom:2px solid var(--sl-color-gray-5);color:var(--sl-color-gray-3);outline-offset:var(--sl-outline-offset-inside);overflow-wrap:initial}.tab:where(.astro-esqgolmp) :where(.astro-esqgolmp)[role=tab][aria-selected=true]{color:var(--sl-color-white);border-color:var(--sl-color-text-accent);font-weight:600}.tablist-wrapper:where(.astro-esqgolmp)~[role=tabpanel]{margin-top:1rem}
.sl-steps{--bullet-size: calc(var(--sl-line-height) * 1rem);--bullet-margin: .375rem;list-style:none;counter-reset:steps-counter var(--sl-steps-start, 0);padding-inline-start:0}.sl-steps>li{counter-increment:steps-counter;position:relative;padding-inline-start:calc(var(--bullet-size) + 1rem);padding-bottom:1px;min-height:calc(var(--bullet-size) + var(--bullet-margin))}.sl-steps>li+li{margin-top:0}.sl-steps>li:before{content:counter(steps-counter);position:absolute;top:0;inset-inline-start:0;width:var(--bullet-size);height:var(--bullet-size);line-height:var(--bullet-size);font-size:var(--sl-text-xs);font-weight:600;text-align:center;color:var(--sl-color-white);background-color:var(--sl-color-gray-6);border-radius:99rem;box-shadow:inset 0 0 0 1px var(--sl-color-gray-5)}.sl-steps>li:after{--guide-width: 1px;content:"";position:absolute;top:calc(var(--bullet-size) + var(--bullet-margin));bottom:var(--bullet-margin);inset-inline-start:calc((var(--bullet-size) - var(--guide-width)) / 2);width:var(--guide-width);background-color:var(--sl-color-hairline-light)}.sl-steps>li>:first-child{--lh: calc(1em * var(--sl-line-height));--shift-y: calc(.5 * (var(--bullet-size) - var(--lh)));transform:translateY(var(--shift-y));margin-bottom:var(--shift-y)}.sl-steps>li>:first-child:where(h1,h2,h3,h4,h5,h6){--lh: calc(1em * var(--sl-line-height-headings))}@supports (--prop: 1lh){.sl-steps>li>:first-child{--lh: 1lh}}
</style><script type="module" src="/xs/_astro/page.7qqag-5g.js"></script></head> <body class="astro-bguv2lll"> <a href="#_top" class="astro-7q3lir66">Skip to content</a>  <div class="page sl-flex astro-vrdttmbt"> <header class="header astro-vrdttmbt"><div class="header sl-flex astro-kmkmnagf"> <div class="title-wrapper sl-flex astro-kmkmnagf"> <a href="/xs/" class="site-title sl-flex astro-m46x6ez3">  <span class="astro-m46x6ez3" translate="no"> cross.stream </span> </a>  </div> <div class="sl-flex astro-kmkmnagf"> <site-search class="astro-kmkmnagf astro-v37mnknz" data-translations="{&#34;placeholder&#34;:&#34;Search&#34;}"> <button data-open-modal disabled aria-label="Search" aria-keyshortcuts="Control+K" class="astro-v37mnknz"> <svg aria-hidden="true" class="astro-v37mnknz astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.71 20.29 18 16.61A9 9 0 1 0 16.61 18l3.68 3.68a.999.999 0 0 0 1.42 0 1 1 0 0 0 0-1.39ZM11 18a7 7 0 1 1 0-14 7 7 0 0 1 0 14Z"/></svg>  <span class="sl-hidden md:sl-block astro-v37mnknz" aria-hidden="true">Search</span> <kbd class="sl-hidden md:sl-flex astro-v37mnknz" style="display: none;"> <kbd class="astro-v37mnknz">Ctrl</kbd><kbd class="astro-v37mnknz">K</kbd> </kbd> </button> <dialog style="padding:0" aria-label="Search" class="astro-v37mnknz"> <div class="dialog-frame sl-flex astro-v37mnknz">  <button data-close-modal class="sl-flex md:sl-hidden astro-v37mnknz"> Cancel </button> <div class="search-container astro-v37mnknz"> <div id="starlight__search" class="astro-v37mnknz"></div> </div> </div> </dialog> </site-search>  <script>
	(() => {
		const openBtn = document.querySelector('button[data-open-modal]');
		const shortcut = openBtn?.querySelector('kbd');
		if (!openBtn || !(shortcut instanceof HTMLElement)) return;
		const platformKey = shortcut.querySelector('kbd');
		if (platformKey && /(Mac|iPhone|iPod|iPad)/i.test(navigator.platform)) {
			platformKey.textContent = '⌘';
			openBtn.setAttribute('aria-keyshortcuts', 'Meta+K');
		}
		shortcut.style.display = '';
	})();
</script> <script type="module" src="/xs/_astro/Search.astro_astro_type_script_index_0_lang.BYRTW6oY.js"></script>   </div> <div class="sl-hidden md:sl-flex right-group astro-kmkmnagf"> <div class="sl-flex social-icons astro-kmkmnagf"> <a href="https://github.com/cablehead/xs" rel="me" class="sl-flex astro-wy4te6ga"><span class="sr-only astro-wy4te6ga">GitHub</span><svg aria-hidden="true" class="astro-wy4te6ga astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M12 .3a12 12 0 0 0-3.8 23.38c.6.12.83-.26.83-.57L9 21.07c-3.34.72-4.04-1.61-4.04-1.61-.55-1.39-1.34-1.76-1.34-1.76-1.08-.74.09-.73.09-.73 1.2.09 1.83 1.24 1.83 1.24 1.08 1.83 2.81 1.3 3.5 1 .1-.78.42-1.31.76-1.61-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.14-.3-.54-1.52.1-3.18 0 0 1-.32 3.3 1.23a11.5 11.5 0 0 1 6 0c2.28-1.55 3.29-1.23 3.29-1.23.64 1.66.24 2.88.12 3.18a4.65 4.65 0 0 1 1.23 3.22c0 4.61-2.8 5.63-5.48 5.92.42.36.81 1.1.81 2.22l-.01 3.29c0 .31.2.69.82.57A12 12 0 0 0 12 .3Z"/></svg> </a><a href="https://discord.com/invite/YNbScHBHrh" rel="me" class="sl-flex astro-wy4te6ga"><span class="sr-only astro-wy4te6ga">Discord</span><svg aria-hidden="true" class="astro-wy4te6ga astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M20.32 4.37a19.8 19.8 0 0 0-4.93-1.51 13.78 13.78 0 0 0-.64 1.28 18.27 18.27 0 0 0-5.5 0 12.64 12.64 0 0 0-.64-1.28h-.05A19.74 19.74 0 0 0 3.64 4.4 20.26 20.26 0 0 0 .11 18.09l.02.02a19.9 19.9 0 0 0 6.04 3.03l.04-.02a14.24 14.24 0 0 0 1.23-2.03.08.08 0 0 0-.05-.07 13.1 13.1 0 0 1-1.9-.92.08.08 0 0 1 .02-.1 10.2 10.2 0 0 0 .41-.31h.04a14.2 14.2 0 0 0 12.1 0l.04.01a9.63 9.63 0 0 0 .4.32.08.08 0 0 1-.03.1 12.29 12.29 0 0 1-1.9.91.08.08 0 0 0-.02.1 15.97 15.97 0 0 0 1.27 2.01h.04a19.84 19.84 0 0 0 6.03-3.05v-.03a20.12 20.12 0 0 0-3.57-13.69ZM8.02 15.33c-1.18 0-2.16-1.08-2.16-2.42 0-1.33.96-2.42 2.16-2.42 1.21 0 2.18 1.1 2.16 2.42 0 1.34-.96 2.42-2.16 2.42Zm7.97 0c-1.18 0-2.15-1.08-2.15-2.42 0-1.33.95-2.42 2.15-2.42 1.22 0 2.18 1.1 2.16 2.42 0 1.34-.94 2.42-2.16 2.42Z"/></svg> </a> </div> <starlight-theme-select>  <label style="--sl-select-width: 6.25em" class="astro-4yphtoen"> <span class="sr-only astro-4yphtoen">Select theme</span> <svg aria-hidden="true" class="icon label-icon astro-4yphtoen astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg>  <select value="auto" autocomplete="off" class="astro-4yphtoen"> <option value="dark" class="astro-4yphtoen">Dark</option><option value="light" class="astro-4yphtoen">Light</option><option value="auto" selected class="astro-4yphtoen">Auto</option> </select> <svg aria-hidden="true" class="icon caret astro-4yphtoen astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 9.17a1 1 0 0 0-1.41 0L12 12.71 8.46 9.17a1 1 0 1 0-1.41 1.42l4.24 4.24a1.002 1.002 0 0 0 1.42 0L17 10.59a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </label>  </starlight-theme-select>  <script>
	StarlightThemeProvider.updatePickers();
</script> <script type="module">const r="starlight-theme",o=e=>e==="auto"||e==="dark"||e==="light"?e:"auto",c=()=>o(typeof localStorage<"u"&&localStorage.getItem(r));function n(e){typeof localStorage<"u"&&localStorage.setItem(r,e==="light"||e==="dark"?e:"")}const l=()=>matchMedia("(prefers-color-scheme: light)").matches?"light":"dark";function t(e){StarlightThemeProvider.updatePickers(e),document.documentElement.dataset.theme=e==="auto"?l():e,n(e)}matchMedia("(prefers-color-scheme: light)").addEventListener("change",()=>{c()==="auto"&&t("auto")});class s extends HTMLElement{constructor(){super(),t(c()),this.querySelector("select")?.addEventListener("change",a=>{a.currentTarget instanceof HTMLSelectElement&&t(o(a.currentTarget.value))})}}customElements.define("starlight-theme-select",s);</script> <script type="module">class s extends HTMLElement{constructor(){super();const e=this.querySelector("select");e&&(e.addEventListener("change",t=>{t.currentTarget instanceof HTMLSelectElement&&(window.location.pathname=t.currentTarget.value)}),window.addEventListener("pageshow",t=>{if(!t.persisted)return;const n=e.querySelector("option[selected]")?.index;n!==e.selectedIndex&&(e.selectedIndex=n??0)}))}}customElements.define("starlight-lang-select",s);</script> </div> </div> </header> <nav class="sidebar astro-vrdttmbt" aria-label="Main"> <starlight-menu-button class="astro-jif73yzw"> <button aria-expanded="false" aria-label="Menu" aria-controls="starlight__sidebar" class="sl-flex md:sl-hidden astro-jif73yzw"> <svg aria-hidden="true" class="astro-jif73yzw astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M3 8h18a1 1 0 1 0 0-2H3a1 1 0 0 0 0 2Zm18 8H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2Zm0-5H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2Z"/></svg>  </button> </starlight-menu-button> <script type="module">class s extends HTMLElement{constructor(){super(),this.btn=this.querySelector("button"),this.btn.addEventListener("click",()=>this.toggleExpanded());const t=this.closest("nav");t&&t.addEventListener("keyup",e=>this.closeOnEscape(e))}setExpanded(t){this.setAttribute("aria-expanded",String(t)),document.body.toggleAttribute("data-mobile-menu-expanded",t)}toggleExpanded(){this.setExpanded(this.getAttribute("aria-expanded")!=="true")}closeOnEscape(t){t.code==="Escape"&&(this.setExpanded(!1),this.btn.focus())}}customElements.define("starlight-menu-button",s);</script>   <div id="starlight__sidebar" class="sidebar-pane astro-vrdttmbt"> <div class="sidebar-content sl-flex astro-vrdttmbt"> <sl-sidebar-state-persist data-hash="17n505m" class="astro-kku4brbg"> <script aria-hidden="true">
		(() => {
			try {
				if (!matchMedia('(min-width: 50em)').matches) return;
				/** @type {HTMLElement | null} */
				const target = document.querySelector('sl-sidebar-state-persist');
				const state = JSON.parse(sessionStorage.getItem('sl-sidebar-state') || '0');
				if (!target || !state || target.dataset.hash !== state.hash) return;
				window._starlightScrollRestore = state.scroll;
				customElements.define(
					'sl-sidebar-restore',
					class SidebarRestore extends HTMLElement {
						connectedCallback() {
							try {
								const idx = parseInt(this.dataset.index || '');
								const details = this.closest('details');
								if (details && typeof state.open[idx] === 'boolean') details.open = state.open[idx];
							} catch {}
						}
					}
				);
			} catch {}
		})();
	</script>  <ul class="top-level astro-3ii7xxms"> <li class="astro-3ii7xxms"> <details open class="astro-3ii7xxms"> <sl-sidebar-restore data-index="0"></sl-sidebar-restore> <summary class="astro-3ii7xxms"> <div class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Getting Started</span>  </div> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </summary> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/xs/getting-started/installation/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Installation</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/xs/getting-started/first-stream/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Your First Stream</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/xs/getting-started/concepts/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Core Concepts</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details open class="astro-3ii7xxms"> <sl-sidebar-restore data-index="1"></sl-sidebar-restore> <summary class="astro-3ii7xxms"> <div class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Tutorials</span>  </div> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </summary> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/xs/tutorials/threaded-conversations/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Threaded Conversations</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/xs/tutorials/mcp-integration/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Integrating MCP Servers</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/xs/tutorials/datastar-todomvc/" aria-current="page" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">TodoMVC with Datastar</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details open class="astro-3ii7xxms"> <sl-sidebar-restore data-index="2"></sl-sidebar-restore> <summary class="astro-3ii7xxms"> <div class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Reference</span>  </div> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </summary> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/xs/reference/cli/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">cli</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/xs/reference/xs-nu/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">xs.nu</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/xs/reference/exposing-streams/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Exposing Streams</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/xs/reference/generators/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Generators</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/xs/reference/handlers/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Handlers</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/xs/reference/commands/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Commands</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/xs/reference/contexts/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Working with Contexts</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/xs/reference/architecture/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Architecture</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/xs/reference/import-export/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Import &amp; Export</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/xs/reference/topic-suffixes/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Topic Suffixes</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/xs/reference/store-api/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Store API</span>  </a> </li> </ul>  </details> </li> </ul>   <script aria-hidden="true">
		(() => {
			const scroller = document.getElementById('starlight__sidebar');
			if (!window._starlightScrollRestore || !scroller) return;
			scroller.scrollTop = window._starlightScrollRestore;
			delete window._starlightScrollRestore;
		})();
	</script> </sl-sidebar-state-persist>  <div class="md:sl-hidden"> <div class="mobile-preferences sl-flex astro-wu23bvmt"> <div class="sl-flex social-icons astro-wu23bvmt"> <a href="https://github.com/cablehead/xs" rel="me" class="sl-flex astro-wy4te6ga"><span class="sr-only astro-wy4te6ga">GitHub</span><svg aria-hidden="true" class="astro-wy4te6ga astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M12 .3a12 12 0 0 0-3.8 23.38c.6.12.83-.26.83-.57L9 21.07c-3.34.72-4.04-1.61-4.04-1.61-.55-1.39-1.34-1.76-1.34-1.76-1.08-.74.09-.73.09-.73 1.2.09 1.83 1.24 1.83 1.24 1.08 1.83 2.81 1.3 3.5 1 .1-.78.42-1.31.76-1.61-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.14-.3-.54-1.52.1-3.18 0 0 1-.32 3.3 1.23a11.5 11.5 0 0 1 6 0c2.28-1.55 3.29-1.23 3.29-1.23.64 1.66.24 2.88.12 3.18a4.65 4.65 0 0 1 1.23 3.22c0 4.61-2.8 5.63-5.48 5.92.42.36.81 1.1.81 2.22l-.01 3.29c0 .31.2.69.82.57A12 12 0 0 0 12 .3Z"/></svg> </a><a href="https://discord.com/invite/YNbScHBHrh" rel="me" class="sl-flex astro-wy4te6ga"><span class="sr-only astro-wy4te6ga">Discord</span><svg aria-hidden="true" class="astro-wy4te6ga astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M20.32 4.37a19.8 19.8 0 0 0-4.93-1.51 13.78 13.78 0 0 0-.64 1.28 18.27 18.27 0 0 0-5.5 0 12.64 12.64 0 0 0-.64-1.28h-.05A19.74 19.74 0 0 0 3.64 4.4 20.26 20.26 0 0 0 .11 18.09l.02.02a19.9 19.9 0 0 0 6.04 3.03l.04-.02a14.24 14.24 0 0 0 1.23-2.03.08.08 0 0 0-.05-.07 13.1 13.1 0 0 1-1.9-.92.08.08 0 0 1 .02-.1 10.2 10.2 0 0 0 .41-.31h.04a14.2 14.2 0 0 0 12.1 0l.04.01a9.63 9.63 0 0 0 .4.32.08.08 0 0 1-.03.1 12.29 12.29 0 0 1-1.9.91.08.08 0 0 0-.02.1 15.97 15.97 0 0 0 1.27 2.01h.04a19.84 19.84 0 0 0 6.03-3.05v-.03a20.12 20.12 0 0 0-3.57-13.69ZM8.02 15.33c-1.18 0-2.16-1.08-2.16-2.42 0-1.33.96-2.42 2.16-2.42 1.21 0 2.18 1.1 2.16 2.42 0 1.34-.96 2.42-2.16 2.42Zm7.97 0c-1.18 0-2.15-1.08-2.15-2.42 0-1.33.95-2.42 2.15-2.42 1.22 0 2.18 1.1 2.16 2.42 0 1.34-.94 2.42-2.16 2.42Z"/></svg> </a> </div> <starlight-theme-select>  <label style="--sl-select-width: 6.25em" class="astro-4yphtoen"> <span class="sr-only astro-4yphtoen">Select theme</span> <svg aria-hidden="true" class="icon label-icon astro-4yphtoen astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg>  <select value="auto" autocomplete="off" class="astro-4yphtoen"> <option value="dark" class="astro-4yphtoen">Dark</option><option value="light" class="astro-4yphtoen">Light</option><option value="auto" selected class="astro-4yphtoen">Auto</option> </select> <svg aria-hidden="true" class="icon caret astro-4yphtoen astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 9.17a1 1 0 0 0-1.41 0L12 12.71 8.46 9.17a1 1 0 1 0-1.41 1.42l4.24 4.24a1.002 1.002 0 0 0 1.42 0L17 10.59a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </label>  </starlight-theme-select>  <script>
	StarlightThemeProvider.updatePickers();
</script>   </div>  </div> </div> </div> </nav> <div class="main-frame astro-vrdttmbt">  <script type="module">const a=document.getElementById("starlight__sidebar"),n=a?.querySelector("sl-sidebar-state-persist"),o="sl-sidebar-state",i=()=>{let t=[];const e=n?.dataset.hash||"";try{const s=sessionStorage.getItem(o),r=JSON.parse(s||"{}");Array.isArray(r.open)&&r.hash===e&&(t=r.open)}catch{}return{hash:e,open:t,scroll:a?.scrollTop||0}},c=t=>{try{sessionStorage.setItem(o,JSON.stringify(t))}catch{}},d=()=>c(i()),l=(t,e)=>{const s=i();s.open[e]=t,c(s)};n?.addEventListener("click",t=>{if(!(t.target instanceof Element))return;const e=t.target.closest("summary")?.closest("details");if(!e)return;const s=e.querySelector("sl-sidebar-restore"),r=parseInt(s?.dataset.index||"");isNaN(r)||l(!e.open,r)});addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&d()});addEventListener("pageHide",d);</script> <div class="lg:sl-flex astro-67yu43on"> <aside class="right-sidebar-container astro-67yu43on"> <div class="right-sidebar astro-67yu43on"> <div class="lg:sl-hidden astro-pb3aqygn"><mobile-starlight-toc data-min-h="2" data-max-h="3" class="astro-doynk5tl"><nav aria-labelledby="starlight__on-this-page--mobile" class="astro-doynk5tl"><details id="starlight__mobile-toc" class="astro-doynk5tl"><summary id="starlight__on-this-page--mobile" class="sl-flex astro-doynk5tl"><div class="toggle sl-flex astro-doynk5tl">On this page<svg aria-hidden="true" class="caret astro-doynk5tl astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </div><span class="display-current astro-doynk5tl"></span></summary><div class="dropdown astro-doynk5tl"><ul class="isMobile astro-g2bywc46" style="--depth: 0;"> <li class="astro-g2bywc46" style="--depth: 0;"> <a href="#_top" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Overview</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#what-youll-learn" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">What You’ll Learn</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#prerequisites" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Prerequisites</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#add-a-todo" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Add a Todo</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#see-the-event" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">See the Event</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#add-another-todo" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Add Another Todo</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#completing-a-todo" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Completing a Todo</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#aggregated-view" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Aggregated View</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#real-time-aggregation" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Real-Time Aggregation</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#html-visualization" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">HTML Visualization</span> </a> <ul class="isMobile astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#minijinja-cli" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">minijinja-cli</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#server-sent-events-endpoint" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Server-Sent Events Endpoint</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#finally-a-little-datastar" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Finally, a little Datastar</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#complete-the-ui-loop" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Complete the UI Loop</span> </a>  </li> </ul> </div></details></nav></mobile-starlight-toc><script type="module" src="/xs/_astro/MobileTableOfContents.astro_astro_type_script_index_0_lang.C181hMzK.js"></script></div><div class="right-sidebar-panel sl-hidden lg:sl-block astro-pb3aqygn"><div class="sl-container astro-pb3aqygn"><starlight-toc data-min-h="2" data-max-h="3"><nav aria-labelledby="starlight__on-this-page"><h2 id="starlight__on-this-page">On this page</h2><ul class="astro-g2bywc46" style="--depth: 0;"> <li class="astro-g2bywc46" style="--depth: 0;"> <a href="#_top" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Overview</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#what-youll-learn" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">What You’ll Learn</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#prerequisites" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Prerequisites</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#add-a-todo" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Add a Todo</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#see-the-event" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">See the Event</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#add-another-todo" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Add Another Todo</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#completing-a-todo" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Completing a Todo</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#aggregated-view" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Aggregated View</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#real-time-aggregation" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Real-Time Aggregation</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#html-visualization" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">HTML Visualization</span> </a> <ul class="astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#minijinja-cli" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">minijinja-cli</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#server-sent-events-endpoint" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Server-Sent Events Endpoint</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#finally-a-little-datastar" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Finally, a little Datastar</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#complete-the-ui-loop" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Complete the UI Loop</span> </a>  </li> </ul> </nav></starlight-toc><script type="module" src="/xs/_astro/TableOfContents.astro_astro_type_script_index_0_lang.CKWWgpjV.js"></script></div></div> </div> </aside> <div class="main-pane astro-67yu43on">  <main data-pagefind-body class="astro-bguv2lll" lang="en" dir="ltr">    <div class="content-panel astro-7nkwcw3z"> <div class="sl-container astro-7nkwcw3z"> <h1 id="_top" class="astro-j6tvhyss">TodoMVC with Datastar</h1>  </div> </div>  <div class="content-panel astro-7nkwcw3z"> <div class="sl-container astro-7nkwcw3z"> <div class="sl-markdown-content"> <p>This tutorial demonstrates the hypermedia/immediate mode approach to web development: backend-first development where the server drives UI updates by streaming HTML fragments to the client. We’ll use <a href="https://data-star.dev/">Datastar</a> for reactive frontend bindings.</p>
<p><img src="/xs/_astro/datastar.DZ4P2kzC_Z1miElW.webp" alt="Datastar TodoMVC Demo" loading="lazy" decoding="async" fetchpriority="auto" width="24" height="24"></p>
<div class="card-grid astro-zntqmydn"><article class="card sl-flex astro-v5tidmuc"> <p class="title sl-flex astro-v5tidmuc"> <svg aria-hidden="true" class="icon astro-v5tidmuc astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.333em;"><path fill-rule="evenodd" d="M1.44 8.855v-.001l3.527-3.516c.34-.344.802-.541 1.285-.548h6.649l.947-.947c3.07-3.07 6.207-3.072 7.62-2.868a1.821 1.821 0 0 1 1.557 1.557c.204 1.413.203 4.55-2.868 7.62l-.946.946v6.649a1.845 1.845 0 0 1-.549 1.286l-3.516 3.528a1.844 1.844 0 0 1-3.11-.944l-.858-4.275-4.52-4.52-2.31-.463-1.964-.394A1.847 1.847 0 0 1 .98 10.693a1.843 1.843 0 0 1 .46-1.838Zm5.379 2.017-3.873-.776L6.32 6.733h4.638l-4.14 4.14Zm8.403-5.655c2.459-2.46 4.856-2.463 5.89-2.33.134 1.035.13 3.432-2.329 5.891l-6.71 6.71-3.561-3.56 6.71-6.711Zm-1.318 15.837-.776-3.873 4.14-4.14v4.639l-3.364 3.374Z" clip-rule="evenodd"/><path d="M9.318 18.345a.972.972 0 0 0-1.86-.561c-.482 1.435-1.687 2.204-2.934 2.619a8.22 8.22 0 0 1-1.23.302c.062-.365.157-.79.303-1.229.415-1.247 1.184-2.452 2.62-2.935a.971.971 0 1 0-.62-1.842c-.12.04-.236.084-.35.13-2.02.828-3.012 2.588-3.493 4.033a10.383 10.383 0 0 0-.51 2.845l-.001.016v.063c0 .536.434.972.97.972H2.24a7.21 7.21 0 0 0 .878-.065c.527-.063 1.248-.19 2.02-.447 1.445-.48 3.205-1.472 4.033-3.494a5.828 5.828 0 0 0 .147-.407Z"/></svg>  <span class="astro-v5tidmuc">Live Demo</span> </p> <div class="body astro-v5tidmuc"><p><strong><a href="https://datastar-todomvc.cross.stream">Try it live</a></strong> - see the reactive
TodoMVC in action!</p></div> </article> <article class="card sl-flex astro-v5tidmuc"> <p class="title sl-flex astro-v5tidmuc"> <svg aria-hidden="true" class="icon astro-v5tidmuc astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.333em;"><path d="M21.17 2.06A13.1 13.1 0 0 0 19 1.87a12.94 12.94 0 0 0-7 2.05 12.94 12.94 0 0 0-7-2 13.1 13.1 0 0 0-2.17.19 1 1 0 0 0-.83 1v12a1 1 0 0 0 1.17 1 10.9 10.9 0 0 1 8.25 1.91l.12.07h.11a.91.91 0 0 0 .7 0h.11l.12-.07A10.899 10.899 0 0 1 20.83 16 1 1 0 0 0 22 15V3a1 1 0 0 0-.83-.94ZM11 15.35a12.87 12.87 0 0 0-6-1.48H4v-10c.333-.02.667-.02 1 0a10.86 10.86 0 0 1 6 1.8v9.68Zm9-1.44h-1a12.87 12.87 0 0 0-6 1.48V5.67a10.86 10.86 0 0 1 6-1.8c.333-.02.667-.02 1 0v10.04Zm1.17 4.15a13.098 13.098 0 0 0-2.17-.19 12.94 12.94 0 0 0-7 2.05 12.94 12.94 0 0 0-7-2.05c-.727.003-1.453.066-2.17.19A1 1 0 0 0 2 19.21a1 1 0 0 0 1.17.79 10.9 10.9 0 0 1 8.25 1.91 1 1 0 0 0 1.16 0A10.9 10.9 0 0 1 20.83 20a1 1 0 0 0 1.17-.79 1 1 0 0 0-.83-1.15Z"/></svg>  <span class="astro-v5tidmuc">Original Guide</span> </p> <div class="body astro-v5tidmuc"><p><strong><a href="https://data-star.dev/examples/todomvc">Datastar’s TodoMVC example</a></strong> -
the original implementation this is based on.</p></div> </article> <article class="card sl-flex astro-v5tidmuc"> <p class="title sl-flex astro-v5tidmuc"> <svg aria-hidden="true" class="icon astro-v5tidmuc astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.333em;"><path d="M12 .3a12 12 0 0 0-3.8 23.38c.6.12.83-.26.83-.57L9 21.07c-3.34.72-4.04-1.61-4.04-1.61-.55-1.39-1.34-1.76-1.34-1.76-1.08-.74.09-.73.09-.73 1.2.09 1.83 1.24 1.83 1.24 1.08 1.83 2.81 1.3 3.5 1 .1-.78.42-1.31.76-1.61-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.14-.3-.54-1.52.1-3.18 0 0 1-.32 3.3 1.23a11.5 11.5 0 0 1 6 0c2.28-1.55 3.29-1.23 3.29-1.23.64 1.66.24 2.88.12 3.18a4.65 4.65 0 0 1 1.23 3.22c0 4.61-2.8 5.63-5.48 5.92.42.36.81 1.1.81 2.22l-.01 3.29c0 .31.2.69.82.57A12 12 0 0 0 12 .3Z"/></svg>  <span class="astro-v5tidmuc">Source Code</span> </p> <div class="body astro-v5tidmuc"><p><strong><a href="https://github.com/cablehead/xs/tree/main/examples/datastar-todomvc">View on
GitHub</a></strong></p><ul>
<li>explore the complete working example.</li>
</ul></div> </article> </div> 
<h2 id="what-youll-learn">What You’ll Learn</h2>
<ul>
<li>Event sourcing with xs streams</li>
<li>Server-driven UI updates via Server-Sent Events streaming HTML fragments, no client-side state management</li>
<li><a href="https://data-star.dev/">Datastar</a> reactive bindings</li>
<li>Hypermedia principles: server owns all state, UI is pure projection</li>
</ul>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li><a href="https://github.com/cablehead/xs">xs</a> running</li>
<li><a href="https://github.com/mitsuhiko/minijinja">minijinja-cli</a> for templating</li>
<li><a href="https://github.com/cablehead/http-nu">http-nu</a> for serving</li>
</ul>
<h2 id="add-a-todo">Add a Todo</h2>
<p>What may not be intuitive about event sourcing - and by extension, <a href="https://data-star.dev">Datastar’s</a> hypermedia approach - is when you have an idea, you don’t start with the UI. You start with the event stream. I like to call this “stream driven development”. So, we’re making a todo app? Let’s start by adding a todo event to the stream and build from there:</p>
<div class="expressive-code"><link rel="stylesheet" href="/xs/_astro/ec.c3kn2.css"><script type="module" src="/xs/_astro/ec.8zarh.js"></script><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span style="--0:#50FA7B;--1:#8A5351">.append</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">todos</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#286983">--meta</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">{action:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--1:#855A1E"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">add</span><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">,</span></span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">text:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--1:#855A1E"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">Learn event sourcing</span><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">}</span></span></div></div></code></pre><pre class="output"><div>───────┬─────────────────────────────────────────────────────</div><div> topic │ todos</div><div> id    │ 03elvd78yq84vp6botmro8jyt</div><div> hash  │</div><div> meta  │ ────────┬──────────────────────</div><div>       │  action │ add</div><div>       │  text   │ Learn event sourcing</div><div>       │ ────────┴──────────────────────</div><div> ttl   │</div><div>───────┴─────────────────────────────────────────────────────</div></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code=".append todos --meta {action: &#x22;add&#x22;, text: &#x22;Learn event sourcing&#x22;}"><div></div></button></div></figure></div>
<h2 id="see-the-event">See the Event</h2>
<p>Check what’s in the store:</p>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span style="--0:#50FA7B;--1:#8A5351">.cat</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--1:#286983">|</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#50FA7B;--1:#8A5351">where</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">topic</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">==</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--1:#855A1E"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">todos</span><span style="--0:#E9F284">"</span></span></div></div></code></pre><pre class="output"><div>─#─┬─topic─┬────────────id─────────────┬─hash─┬──────────────meta───────────────</div><div> 0 │ todos │ 03elvd78yq84vp6botmro8jyt │      │ ────────┬──────────────────────</div><div>   │       │                           │      │  action │ add</div><div>   │       │                           │      │  text   │ Learn event sourcing</div><div>   │       │                           │      │ ────────┴──────────────────────</div><div>───┴───────┴───────────────────────────┴──────┴─────────────────────────────────</div></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code=".cat | where topic == &#x22;todos&#x22;"><div></div></button></div></figure></div>
<h2 id="add-another-todo">Add Another Todo</h2>
<p>Now let’s add a second todo and capture the returned frame:</p>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span style="--0:#8BE9FD;--1:#8F4F61;--1fs:italic">let</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">todo</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">=</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">.append</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">todos</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#286983">--meta</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">{action:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--1:#855A1E"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">add</span><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">,</span></span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">text:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--1:#855A1E"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">Build something cool</span><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">}</span></span></div></div><div class="ec-line"><div class="code"><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$todo</span></div></div></code></pre><pre class="output"><div>───────┬─────────────────────────────────────────────────────</div><div> topic │ todos</div><div> id    │ 03elvd8txt25bf13qyggp0cdp</div><div> hash  │</div><div> meta  │ ────────┬──────────────────────</div><div>       │  action │ add</div><div>       │  text   │ Build something cool</div><div>       │ ────────┴──────────────────────</div><div> ttl   │</div><div>───────┴─────────────────────────────────────────────────────</div></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="let todo = .append todos --meta {action: &#x22;add&#x22;, text: &#x22;Build something cool&#x22;}$todo"><div></div></button></div></figure></div>
<h2 id="completing-a-todo">Completing a Todo</h2>
<p>OK, now let’s mark that second todo as complete. With event streams, you express updates by appending more events. We’ll make use of metadata to point to the frame we are modifying:</p>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span style="--0:#50FA7B;--1:#8A5351">.append</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">todos</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#286983">--meta</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">{action:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--1:#855A1E"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">toggle</span><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">,</span></span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">id:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$todo</span><span style="--0:#F1FA8C;--1:#855A1E">.id}</span></div></div></code></pre><pre class="output"><div>───────┬─────────────────────────────────────────────────────</div><div> topic │ todos</div><div> id    │ 03elvdlutpeeusqvf1xfdf7ig</div><div> hash  │</div><div> meta  │ ────────┬───────────────────────────</div><div>       │  action │ toggle</div><div>       │  id     │ 03elvd8txt25bf13qyggp0cdp</div><div>       │ ────────┴───────────────────────────</div><div> ttl   │</div><div>───────┴─────────────────────────────────────────────────────</div></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code=".append todos --meta {action: &#x22;toggle&#x22;, id: $todo.id}"><div></div></button></div></figure></div>
<p>Check the stream:</p>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span style="--0:#50FA7B;--1:#8A5351">.cat</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--1:#286983">|</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#50FA7B;--1:#8A5351">where</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">topic</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">==</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--1:#855A1E"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">todos</span><span style="--0:#E9F284">"</span></span></div></div></code></pre><pre class="output"><div>─#─┬─topic─┬────────────id─────────────┬─hash─┬──────────────meta───────────────</div><div> 0 │ todos │ 03elvd78yq84vp6botmro8jyt │      │ ────────┬──────────────────────</div><div>   │       │                           │      │  action │ add</div><div>   │       │                           │      │  text   │ Learn event sourcing</div><div>   │       │                           │      │ ────────┴──────────────────────</div><div> 1 │ todos │ 03elvd8txt25bf13qyggp0cdp │      │ ────────┬──────────────────────</div><div>   │       │                           │      │  action │ add</div><div>   │       │                           │      │  text   │ Build something cool</div><div>   │       │                           │      │ ────────┴──────────────────────</div><div> 2 │ todos │ 03elvdlutpeeusqvf1xfdf7ig │      │ ────────┬───────────────────────────</div><div>   │       │                           │      │  action │ toggle</div><div>   │       │                           │      │  id     │ 03elvd8txt25bf13qyggp0cdp</div><div>   │       │                           │      │ ────────┴───────────────────────────</div><div>───┴───────┴───────────────────────────┴──────┴─────────────────────────────────</div></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code=".cat | where topic == &#x22;todos&#x22;"><div></div></button></div></figure></div>
<p>You now have three events: two “add” events and one “toggle” event.</p>
<h2 id="aggregated-view">Aggregated View</h2>
<p>Raw events are awkward for presenting a summary of the current state of things. We want to create a projection of the stream. We can use an ad-hoc generator to aggregate events into state:</p>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash" class="wrap" style="--ecMaxLine:74ch"><code><div class="ec-line"><div class="code"><span style="--0:#50FA7B;--1:#8A5351">.cat</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--1:#286983">|</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#50FA7B;--1:#8A5351">where</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">topic</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">==</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--1:#855A1E"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">todos</span><span style="--0:#E9F284">"</span></span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--1:#286983">|</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#50FA7B;--1:#8A5351">generate</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">{</span><span style="--0:#FF79C6;--1:#286983">|</span><span style="--0:#50FA7B;--1:#8A5351">frame,</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">todos</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">=</span><span style="--0:#F8F8F2;--1:#575279"> []</span><span style="--0:#FF79C6;--1:#286983">|</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="code"><span class="indent">  </span><span style="--0:#50FA7B;--1:#8A5351">match</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$frame</span><span style="--0:#F1FA8C;--1:#855A1E">.meta.action</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">{</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#50FA7B;--1:#8A5351">"add"</span><span style="--0:#F8F8F2;--1:#575279"> =</span><span style="--0:#FF79C6;--1:#286983">></span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">{</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="code"><span class="indent">      </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$todos</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="code"><span class="indent">      </span><span style="--0:#FF79C6;--1:#286983">|</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#50FA7B;--1:#8A5351">append</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">{id:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$frame</span><span style="--0:#F1FA8C;--1:#855A1E">.id</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">text:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$frame</span><span style="--0:#F1FA8C;--1:#855A1E">.meta.text</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">completed:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#8A5351">false</span><span style="--0:#F1FA8C;--1:#855A1E">}</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="code"><span class="indent">      </span><span style="--0:#FF79C6;--1:#286983">|</span><span style="--0:#F8F8F2;--1:#575279"> {</span><span style="--0:#50FA7B;--1:#8A5351">out:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$in</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">next:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$in</span><span style="--0:#F1FA8C;--1:#855A1E">}</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent"><span style="--0:#F8F8F2;--1:#575279">    </span></span><span style="--0:#F8F8F2;--1:#575279">}</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#50FA7B;--1:#8A5351">"toggle"</span><span style="--0:#F8F8F2;--1:#575279"> =</span><span style="--0:#FF79C6;--1:#286983">></span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">{</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="code"><span class="indent">      </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$todos</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--1:#286983">|</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#50FA7B;--1:#8A5351">each</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">{</span><span style="--0:#FF79C6;--1:#286983">|</span><span style="--0:#50FA7B;--1:#8A5351">todo</span><span style="--0:#FF79C6;--1:#286983">|</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent">        </span><span style="--0:#FF79C6;--1:#286983">if</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$todo</span><span style="--0:#F1FA8C;--1:#855A1E">.id</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">==</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$frame</span><span style="--0:#F1FA8C;--1:#855A1E">.meta.id</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">{</span></div></div><div class="ec-line" style="--ecIndent:10ch"><div class="code"><span class="indent"><span style="--0:#F8F8F2;--1:#575279">          </span></span><span style="--0:#F8F8F2;--1:#575279">{</span><span style="--0:#50FA7B;--1:#8A5351">id:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$todo</span><span style="--0:#F1FA8C;--1:#855A1E">.id</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">text:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$todo</span><span style="--0:#F1FA8C;--1:#855A1E">.text</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">completed:</span><span style="--0:#F8F8F2;--1:#575279"> (not </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$todo</span><span style="--0:#F1FA8C;--1:#855A1E">.completed</span><span style="--0:#F8F8F2;--1:#575279">)}</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent"><span style="--0:#F8F8F2;--1:#575279">        </span></span><span style="--0:#F8F8F2;--1:#575279">} </span><span style="--0:#FF79C6;--1:#286983">else</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#625F77">{</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$todo</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">}</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="code"><span class="indent"><span style="--0:#F8F8F2">      </span></span><span style="--0:#F8F8F2;--1:#625F77">}</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--1:#286983">|</span><span style="--0:#F8F8F2;--1:#575279"> {</span><span style="--0:#50FA7B;--1:#8A5351">out:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$in</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">next:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$in</span><span style="--0:#F1FA8C;--1:#855A1E">}</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent"><span style="--0:#F8F8F2;--1:#575279">    </span></span><span style="--0:#F8F8F2;--1:#575279">}</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#50FA7B;--1:#8A5351">_</span><span style="--0:#F8F8F2;--1:#575279"> =</span><span style="--0:#FF79C6;--1:#286983">></span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">{next:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$todos</span><span style="--0:#F1FA8C;--1:#855A1E">}</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#F8F8F2;--1:#575279">  </span></span><span style="--0:#F8F8F2;--1:#575279">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#575279">} | last</span></div></div></code></pre><pre class="output"><div>─#─┬────────────id─────────────┬─────────text─────────┬─completed─</div><div> 0 │ 03elvd78yq84vp6botmro8jyt │ Learn event sourcing │ false</div><div> 1 │ 03elvd8txt25bf13qyggp0cdp │ Build something cool │ true</div><div>───┴───────────────────────────┴──────────────────────┴───────────</div></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code=".cat | where topic == &#x22;todos&#x22; | generate {|frame, todos = []|  match $frame.meta.action {    &#x22;add&#x22; => {      $todos      | append {id: $frame.id text: $frame.meta.text completed: false}      | {out: $in next: $in}    }    &#x22;toggle&#x22; => {      $todos | each {|todo|        if $todo.id == $frame.meta.id {          {id: $todo.id text: $todo.text completed: (not $todo.completed)}        } else { $todo }      } | {out: $in next: $in}    }    _ => {next: $todos}  }} | last"><div></div></button></div></figure></div>
<p>The generate command processes each event to build current state:</p>
<ol>
<li><strong>Start with empty todos list</strong> - <code dir="auto">todos = []</code></li>
<li><strong>Process each frame</strong> - for every event in the stream</li>
<li><strong>“add” events</strong> - append new todo with <code dir="auto">completed: false</code></li>
<li><strong>“toggle” events</strong> - find matching ID and flip completion status</li>
<li><strong>Output current state</strong> - <code dir="auto">{out: $in next: $in}</code> emits the updated list</li>
<li><strong>Get final result</strong> - <code dir="auto">| last</code> gives us the current aggregated state</li>
</ol>
<p>This shows the current aggregated state: a list of todos with their completion status.</p>
<h2 id="real-time-aggregation">Real-Time Aggregation</h2>
<p>Let’s see the aggregated projection update in real-time. In a second terminal window, run the <a href="#aggregated-view">same generate command</a> with live streaming:</p>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span style="--0:#50FA7B;--1:#8A5351">.cat</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#286983">-f</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--1:#286983">|</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#50FA7B;--1:#8A5351">where</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">topic</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">==</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--1:#855A1E"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">todos</span><span style="--0:#E9F284">"</span></span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--1:#286983">|</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#50FA7B;--1:#8A5351">generate</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">{</span><span style="--0:#FF79C6;--1:#286983">|</span><span style="--0:#50FA7B;--1:#8A5351">frame,</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">todos</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">=</span><span style="--0:#F8F8F2;--1:#575279"> []</span><span style="--0:#FF79C6;--1:#286983">|</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#50FA7B;--1:#8A5351">match</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$frame</span><span style="--0:#F1FA8C;--1:#855A1E">.meta.action</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#50FA7B;--1:#8A5351">"add"</span><span style="--0:#F8F8F2;--1:#575279"> =</span><span style="--0:#FF79C6;--1:#286983">></span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$todos</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#FF79C6;--1:#286983">|</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#50FA7B;--1:#8A5351">append</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">{id:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$frame</span><span style="--0:#F1FA8C;--1:#855A1E">.id</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">text:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$frame</span><span style="--0:#F1FA8C;--1:#855A1E">.meta.text</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">completed:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#8A5351">false</span><span style="--0:#F1FA8C;--1:#855A1E">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#FF79C6;--1:#286983">|</span><span style="--0:#F8F8F2;--1:#575279"> {</span><span style="--0:#50FA7B;--1:#8A5351">out:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$in</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">next:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$in</span><span style="--0:#F1FA8C;--1:#855A1E">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2;--1:#575279">    </span></span><span style="--0:#F8F8F2;--1:#575279">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#50FA7B;--1:#8A5351">"toggle"</span><span style="--0:#F8F8F2;--1:#575279"> =</span><span style="--0:#FF79C6;--1:#286983">></span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$todos</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--1:#286983">|</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#50FA7B;--1:#8A5351">each</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">{</span><span style="--0:#FF79C6;--1:#286983">|</span><span style="--0:#50FA7B;--1:#8A5351">todo</span><span style="--0:#FF79C6;--1:#286983">|</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#FF79C6;--1:#286983">if</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$todo</span><span style="--0:#F1FA8C;--1:#855A1E">.id</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">==</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$frame</span><span style="--0:#F1FA8C;--1:#855A1E">.meta.id</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">{</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2;--1:#575279">          </span></span><span style="--0:#F8F8F2;--1:#575279">{</span><span style="--0:#50FA7B;--1:#8A5351">id:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$todo</span><span style="--0:#F1FA8C;--1:#855A1E">.id</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">text:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$todo</span><span style="--0:#F1FA8C;--1:#855A1E">.text</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">completed:</span><span style="--0:#F8F8F2;--1:#575279"> (not </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$todo</span><span style="--0:#F1FA8C;--1:#855A1E">.completed</span><span style="--0:#F8F8F2;--1:#575279">)}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2;--1:#575279">        </span></span><span style="--0:#F8F8F2;--1:#575279">} </span><span style="--0:#FF79C6;--1:#286983">else</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#625F77">{</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$todo</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2">      </span></span><span style="--0:#F8F8F2;--1:#625F77">}</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--1:#286983">|</span><span style="--0:#F8F8F2;--1:#575279"> {</span><span style="--0:#50FA7B;--1:#8A5351">out:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$in</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">next:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$in</span><span style="--0:#F1FA8C;--1:#855A1E">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2;--1:#575279">    </span></span><span style="--0:#F8F8F2;--1:#575279">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#50FA7B;--1:#8A5351">_</span><span style="--0:#F8F8F2;--1:#575279"> =</span><span style="--0:#FF79C6;--1:#286983">></span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">{next:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$todos</span><span style="--0:#F1FA8C;--1:#855A1E">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2;--1:#575279">  </span></span><span style="--0:#F8F8F2;--1:#575279">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#575279">} | each { print ($in | table -e) }</span></div></div></code></pre><pre class="output"><div>─#─┬────────────id─────────────┬─────────text─────────┬─completed─</div><div> 0 │ 03elvd78yq84vp6botmro8jyt │ Learn event sourcing │ false</div><div>───┴───────────────────────────┴──────────────────────┴───────────</div><div></div><div>─#─┬────────────id─────────────┬─────────text─────────┬─completed─</div><div> 0 │ 03elvd78yq84vp6botmro8jyt │ Learn event sourcing │ false</div><div> 1 │ 03elvd8txt25bf13qyggp0cdp │ Build something cool │ false</div><div>───┴───────────────────────────┴──────────────────────┴───────────</div><div></div><div>─#─┬────────────id─────────────┬─────────text─────────┬─completed─</div><div> 0 │ 03elvd78yq84vp6botmro8jyt │ Learn event sourcing │ false</div><div> 1 │ 03elvd8txt25bf13qyggp0cdp │ Build something cool │ true</div><div>───┴───────────────────────────┴──────────────────────┴───────────</div></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code=".cat -f | where topic == &#x22;todos&#x22; | generate {|frame, todos = []|  match $frame.meta.action {    &#x22;add&#x22; => {      $todos      | append {id: $frame.id text: $frame.meta.text completed: false}      | {out: $in next: $in}    }    &#x22;toggle&#x22; => {      $todos | each {|todo|        if $todo.id == $frame.meta.id {          {id: $todo.id text: $todo.text completed: (not $todo.completed)}        } else { $todo }      } | {out: $in next: $in}    }    _ => {next: $todos}  }} | each { print ($in | table -e) }"><div></div></button></div></figure></div>
<p>You see three outputs - one for each event processed so far. Now toggle that same todo back to incomplete:</p>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span style="--0:#50FA7B;--1:#8A5351">.append</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">todos</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#286983">--meta</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">{action:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--1:#855A1E"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">toggle</span><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">,</span></span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">id:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$todo</span><span style="--0:#F1FA8C;--1:#855A1E">.id}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code=".append todos --meta {action: &#x22;toggle&#x22;, id: $todo.id}"><div></div></button></div></figure></div>
<p>In your watching terminal, you immediately see the new aggregated state:</p>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash"><code></code></pre><pre class="output"><div>─#─┬────────────id─────────────┬─────────text─────────┬─completed─</div><div> 0 │ 03elvd78yq84vp6botmro8jyt │ Learn event sourcing │ false</div><div> 1 │ 03elvd8txt25bf13qyggp0cdp │ Build something cool │ false</div><div>───┴───────────────────────────┴──────────────────────┴───────────</div></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code=""><div></div></button></div></figure></div>
<p>Notice both todos now show as incomplete. The aggregated projection automatically updated in real-time when the new event arrived - this is how reactive systems work with event streams.</p>
<h2 id="html-visualization">HTML Visualization</h2>
<p>Now let’s visualize this projection as HTML fragments. First, save a Jinja2 template:</p>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span style="--0:#50FA7B;--1:#8A5351">r#</span><span style="--0:#F8F8F2;--1:#575279">'</span><span style="--0:#50FA7B;--1:#8A5351">&#x3C;ul</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--1:#855A1E"><span style="--0:#F1FA8C">id=</span><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">todos</span><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">></span></span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#625F77">{</span><span style="--0:#50FA7B;--1:#8A5351">%-</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">for</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">todo</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">in</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">todos</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">%}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#50FA7B;--1:#8A5351">&#x3C;li</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--1:#855A1E"><span style="--0:#F1FA8C">data-completed=</span><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">{{ todo.completed }}</span><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">></span></span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#50FA7B;--1:#8A5351">&#x3C;label></span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#50FA7B;--1:#8A5351">&#x3C;input</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--1:#855A1E"><span style="--0:#F1FA8C">type=</span><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">checkbox</span><span style="--0:#E9F284">"</span></span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">{%</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">if</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">todo.completed</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">%}checked{%</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">endif</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">%}</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">disabled</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">/></span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2">    </span></span><span style="--0:#F8F8F2;--1:#625F77">{</span><span style="--0:#F8F8F2;--1:#575279">{ todo.text }}</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#50FA7B;--1:#8A5351">&#x3C;/label></span></div></div><div class="ec-line"><div class="code"><span style="--0:#50FA7B;--1:#8A5351">&#x3C;/li></span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#625F77">{</span><span style="--0:#50FA7B;--1:#8A5351">%</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">endfor</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#286983">-%</span><span style="--0:#F8F8F2;--1:#625F77">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#50FA7B;--1:#8A5351">&#x3C;/ul></span><span style="--0:#50FA7B;--1:#8A5351">'# | save todo_template.html</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="r#&#x27;<ul id=&#x22;todos&#x22;>{%- for todo in todos %}<li data-completed=&#x22;{{ todo.completed }}&#x22;>  <label>    <input type=&#x22;checkbox&#x22; {% if todo.completed %}checked{% endif %} disabled />    {{ todo.text }}  </label></li>{% endfor -%}</ul>&#x27;# | save todo_template.html"><div></div></button></div></figure></div>
<h3 id="minijinja-cli">minijinja-cli</h3>
<p><a href="https://github.com/mitsuhiko/minijinja">minijinja-cli</a> is a fantastic tool that converts JSON to HTML using Jinja2 templates at the command line. In our example:</p>
<ul>
<li><code dir="auto">todo_template.html</code> - the template file</li>
<li><code dir="auto">-f json</code> - expect JSON input format</li>
<li><code dir="auto">-</code> - read the data that will be fed to the template from stdin</li>
</ul>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#625F77">[</span><span style="--0:#F8F8F2;--1:#575279">{</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2;--1:#575279">  </span></span><span style="--0:#F8F8F2;--1:#575279">id: </span><span style="--1:#855A1E"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">1</span><span style="--0:#E9F284">"</span></span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2;--1:#575279">  </span></span><span style="--0:#F8F8F2;--1:#575279">text: </span><span style="--1:#855A1E"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">Test todo</span><span style="--0:#E9F284">"</span></span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2;--1:#575279">  </span></span><span style="--0:#F8F8F2;--1:#575279">completed: </span><span style="--0:#BD93F9;--1:#8A5351">false</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#575279">} {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2;--1:#575279">  </span></span><span style="--0:#F8F8F2;--1:#575279">id: </span><span style="--1:#855A1E"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">2</span><span style="--0:#E9F284">"</span></span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2;--1:#575279">  </span></span><span style="--0:#F8F8F2;--1:#575279">text: </span><span style="--1:#855A1E"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">Done todo</span><span style="--0:#E9F284">"</span></span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2;--1:#575279">  </span></span><span style="--0:#F8F8F2;--1:#575279">completed: </span><span style="--0:#BD93F9;--1:#8A5351">true</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#575279">}</span><span style="--0:#F8F8F2;--1:#625F77">]</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--1:#286983">|</span><span style="--0:#F8F8F2;--1:#575279"> {</span><span style="--0:#50FA7B;--1:#8A5351">todos:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$in</span><span style="--0:#F1FA8C;--1:#855A1E">}</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--1:#286983">|</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#50FA7B;--1:#8A5351">to</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">json</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#286983">-r</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--1:#286983">|</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#50FA7B;--1:#8A5351">minijinja-cli</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#286983">-f</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">json</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">todo_template.html</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">-</span></div></div></code></pre><pre class="output"><div>&#x3C;ul id="todos"></div><div>&#x3C;li data-completed="false"></div><div>  &#x3C;label></div><div>    &#x3C;input type="checkbox"  disabled /></div><div>    Test todo</div><div>  &#x3C;/label></div><div>&#x3C;/li></div><div>&#x3C;li data-completed="true"></div><div>  &#x3C;label></div><div>    &#x3C;input type="checkbox" checked disabled /></div><div>    Done todo</div><div>  &#x3C;/label></div><div>&#x3C;/li></div><div>&#x3C;/ul></div></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="[{  id: &#x22;1&#x22;  text: &#x22;Test todo&#x22;  completed: false} {  id: &#x22;2&#x22;  text: &#x22;Done todo&#x22;  completed: true}] | {todos: $in} | to json -r | minijinja-cli -f json todo_template.html -"><div></div></button></div></figure></div>
<p>Now run the live stream with HTML rendering:</p>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span style="--0:#50FA7B;--1:#8A5351">.cat</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#286983">-f</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--1:#286983">|</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#50FA7B;--1:#8A5351">where</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">topic</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">==</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--1:#855A1E"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">todos</span><span style="--0:#E9F284">"</span></span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--1:#286983">|</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#50FA7B;--1:#8A5351">generate</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">{</span><span style="--0:#FF79C6;--1:#286983">|</span><span style="--0:#50FA7B;--1:#8A5351">frame,</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">todos</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">=</span><span style="--0:#F8F8F2;--1:#575279"> []</span><span style="--0:#FF79C6;--1:#286983">|</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#50FA7B;--1:#8A5351">match</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$frame</span><span style="--0:#F1FA8C;--1:#855A1E">.meta.action</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#50FA7B;--1:#8A5351">"add"</span><span style="--0:#F8F8F2;--1:#575279"> =</span><span style="--0:#FF79C6;--1:#286983">></span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$todos</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#FF79C6;--1:#286983">|</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#50FA7B;--1:#8A5351">append</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">{id:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$frame</span><span style="--0:#F1FA8C;--1:#855A1E">.id</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">text:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$frame</span><span style="--0:#F1FA8C;--1:#855A1E">.meta.text</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">completed:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#8A5351">false</span><span style="--0:#F1FA8C;--1:#855A1E">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#FF79C6;--1:#286983">|</span><span style="--0:#F8F8F2;--1:#575279"> {</span><span style="--0:#50FA7B;--1:#8A5351">out:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$in</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">next:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$in</span><span style="--0:#F1FA8C;--1:#855A1E">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2;--1:#575279">    </span></span><span style="--0:#F8F8F2;--1:#575279">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#50FA7B;--1:#8A5351">"toggle"</span><span style="--0:#F8F8F2;--1:#575279"> =</span><span style="--0:#FF79C6;--1:#286983">></span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$todos</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--1:#286983">|</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#50FA7B;--1:#8A5351">each</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">{</span><span style="--0:#FF79C6;--1:#286983">|</span><span style="--0:#50FA7B;--1:#8A5351">todo</span><span style="--0:#FF79C6;--1:#286983">|</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#FF79C6;--1:#286983">if</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$todo</span><span style="--0:#F1FA8C;--1:#855A1E">.id</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">==</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$frame</span><span style="--0:#F1FA8C;--1:#855A1E">.meta.id</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">{</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2;--1:#575279">          </span></span><span style="--0:#F8F8F2;--1:#575279">{</span><span style="--0:#50FA7B;--1:#8A5351">id:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$todo</span><span style="--0:#F1FA8C;--1:#855A1E">.id</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">text:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$todo</span><span style="--0:#F1FA8C;--1:#855A1E">.text</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">completed:</span><span style="--0:#F8F8F2;--1:#575279"> (not </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$todo</span><span style="--0:#F1FA8C;--1:#855A1E">.completed</span><span style="--0:#F8F8F2;--1:#575279">)}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2;--1:#575279">        </span></span><span style="--0:#F8F8F2;--1:#575279">} </span><span style="--0:#FF79C6;--1:#286983">else</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#625F77">{</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$todo</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2">      </span></span><span style="--0:#F8F8F2;--1:#625F77">}</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--1:#286983">|</span><span style="--0:#F8F8F2;--1:#575279"> {</span><span style="--0:#50FA7B;--1:#8A5351">out:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$in</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">next:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$in</span><span style="--0:#F1FA8C;--1:#855A1E">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2;--1:#575279">    </span></span><span style="--0:#F8F8F2;--1:#575279">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#50FA7B;--1:#8A5351">_</span><span style="--0:#F8F8F2;--1:#575279"> =</span><span style="--0:#FF79C6;--1:#286983">></span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">{next:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$todos</span><span style="--0:#F1FA8C;--1:#855A1E">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2;--1:#575279">  </span></span><span style="--0:#F8F8F2;--1:#575279">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#575279">} | each { {todos: $in} | to json -r | minijinja-cli -f json todo_template.html - | print $in }</span></div></div></code></pre><pre class="output"><div>&#x3C;ul></div><div>&#x3C;li data-completed="false"></div><div>  &#x3C;label></div><div>    &#x3C;input type="checkbox"  /></div><div>    Learn event sourcing</div><div>  &#x3C;/label></div><div>&#x3C;/li></div><div>&#x3C;/ul></div><div></div><div>&#x3C;ul></div><div>&#x3C;li data-completed="false"></div><div>  &#x3C;label></div><div>    &#x3C;input type="checkbox"  /></div><div>    Learn event sourcing</div><div>  &#x3C;/label></div><div>&#x3C;/li></div><div>&#x3C;li data-completed="false"></div><div>  &#x3C;label></div><div>    &#x3C;input type="checkbox"  /></div><div>    Build something cool</div><div>  &#x3C;/label></div><div>&#x3C;/li></div><div>&#x3C;/ul></div><div></div><div>...</div></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code=".cat -f | where topic == &#x22;todos&#x22; | generate {|frame, todos = []|  match $frame.meta.action {    &#x22;add&#x22; => {      $todos      | append {id: $frame.id text: $frame.meta.text completed: false}      | {out: $in next: $in}    }    &#x22;toggle&#x22; => {      $todos | each {|todo|        if $todo.id == $frame.meta.id {          {id: $todo.id text: $todo.text completed: (not $todo.completed)}        } else { $todo }      } | {out: $in next: $in}    }    _ => {next: $todos}  }} | each { {todos: $in} | to json -r | minijinja-cli -f json todo_template.html - | print $in }"><div></div></button></div></figure></div>
<p>Now toggle the todo several more times and watch the HTML fragments update in real-time:</p>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span style="--0:#50FA7B;--1:#8A5351">.append</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">todos</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#286983">--meta</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">{action:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--1:#855A1E"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">toggle</span><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">,</span></span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">id:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$todo</span><span style="--0:#F1FA8C;--1:#855A1E">.id}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#50FA7B;--1:#8A5351">.append</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">todos</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#286983">--meta</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">{action:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--1:#855A1E"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">toggle</span><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">,</span></span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">id:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$todo</span><span style="--0:#F1FA8C;--1:#855A1E">.id}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#50FA7B;--1:#8A5351">.append</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">todos</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#286983">--meta</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">{action:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--1:#855A1E"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">toggle</span><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">,</span></span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">id:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$todo</span><span style="--0:#F1FA8C;--1:#855A1E">.id}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code=".append todos --meta {action: &#x22;toggle&#x22;, id: $todo.id}.append todos --meta {action: &#x22;toggle&#x22;, id: $todo.id}.append todos --meta {action: &#x22;toggle&#x22;, id: $todo.id}"><div></div></button></div></figure></div>
<p>Each append immediately triggers a new HTML fragment in your watching terminal, showing the updated todo states.</p>
<h2 id="server-sent-events-endpoint">Server-Sent Events Endpoint</h2>
<p>Now let’s make our todo list available over HTTP. Save this closure to a file called <code dir="auto">serve.nu</code>:</p>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="nushell"><code><div class="ec-line"><div class="code"><span style="--0:#96A1C2;--1:#64606C;--1fs:italic"># Point this to wherever you've installed the xs.nu module</span></div></div><div class="ec-line"><div class="code"><span style="--0:#50FA7B;--1:#8A5351">use</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">~/.config/nushell/modules/</span><span style="--0:#F1FA8C;--1:#3D6971">xs</span><span style="--0:#F1FA8C;--1:#855A1E">.nu</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--1:#286983">*</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#625F77">{</span><span style="--0:#F8F8F2;--1:#575279">|</span><span style="--0:#FFB86C;--0fs:italic;--1:#6C5C7F;--1fs:italic">req</span><span style="--0:#F8F8F2;--1:#575279">|</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FF79C6;--1:#286983">match</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#575279;--1fs:italic">$req</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#625F77">{</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2">    </span></span><span style="--0:#F8F8F2;--1:#625F77">{</span><span style="--0:#F8F8F2;--1:#575279;--1fs:italic">method</span><span style="--0:#FF79C6;--1:#286983">:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--1:#855A1E"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">GET</span><span style="--0:#E9F284">"</span></span><span style="--0:#F8F8F2;--1:#575279">, </span><span style="--0:#F8F8F2;--1:#575279;--1fs:italic">path</span><span style="--0:#FF79C6;--1:#286983">:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--1:#855A1E"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">/</span><span style="--0:#E9F284">"</span></span><span style="--0:#F8F8F2;--1:#625F77">}</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">=></span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#625F77">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#8BE9FD;--0fs:italic;--1:#3D6971">.static</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--1:#855A1E"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">.</span><span style="--0:#E9F284">"</span></span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--1:#855A1E"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">index.html</span><span style="--0:#E9F284">"</span></span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2">    </span></span><span style="--0:#F8F8F2;--1:#625F77">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2">    </span></span><span style="--0:#F8F8F2;--1:#625F77">{</span><span style="--0:#F8F8F2;--1:#575279;--1fs:italic">method</span><span style="--0:#FF79C6;--1:#286983">:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--1:#855A1E"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">GET</span><span style="--0:#E9F284">"</span></span><span style="--0:#F8F8F2;--1:#575279">, </span><span style="--0:#F8F8F2;--1:#575279;--1fs:italic">path</span><span style="--0:#FF79C6;--1:#286983">:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--1:#855A1E"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">/updates</span><span style="--0:#E9F284">"</span></span><span style="--0:#F8F8F2;--1:#625F77">}</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">=></span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#625F77">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#8BE9FD;--0fs:italic;--1:#3D6971">.response</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#625F77">{</span><span style="--0:#F8F8F2;--1:#575279;--1fs:italic">headers</span><span style="--0:#FF79C6;--1:#286983">:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#625F77">{</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2">        </span></span><span style="--0:#F8F8F2;--1:#575279;--1fs:italic">"content-type"</span><span style="--0:#FF79C6;--1:#286983">:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--1:#855A1E"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">text/event-stream</span><span style="--0:#E9F284">"</span></span><span style="--0:#F8F8F2;--1:#575279">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2">        </span></span><span style="--0:#F8F8F2;--1:#575279;--1fs:italic">"cache-control"</span><span style="--0:#FF79C6;--1:#286983">:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--1:#855A1E"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">no-cache</span><span style="--0:#E9F284">"</span></span><span style="--0:#F8F8F2;--1:#575279">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2">        </span></span><span style="--0:#F8F8F2;--1:#575279;--1fs:italic">"access-control-allow-origin"</span><span style="--0:#FF79C6;--1:#286983">:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--1:#855A1E"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">*</span><span style="--0:#E9F284">"</span></span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2">      </span></span><span style="--0:#F8F8F2;--1:#625F77">}}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#8BE9FD;--0fs:italic;--1:#3D6971">.cat</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--0fs:italic;--1:#286983;--1fs:italic">-</span><span style="--0:#FFB86C;--0fs:italic;--1:#6C5C7F;--1fs:italic">f</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--1:#286983">|</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--1:#286983">where</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">topic</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--1:#286983">==</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--1:#855A1E"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">todos</span><span style="--0:#E9F284">"</span></span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--1:#286983">|</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--1:#286983">generate</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#625F77">{</span><span style="--0:#F8F8F2;--1:#575279">|</span><span style="--0:#FFB86C;--0fs:italic;--1:#6C5C7F;--1fs:italic">frame</span><span style="--0:#F8F8F2;--1:#575279">, </span><span style="--0:#FFB86C;--0fs:italic;--1:#6C5C7F;--1fs:italic">todos</span><span style="--0:#F8F8F2;--1:#575279"> = []|</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#FF79C6;--1:#286983">match</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#575279;--1fs:italic">$frame.meta.action</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#625F77">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--1:#855A1E"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">add</span><span style="--0:#E9F284">"</span></span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">=></span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#625F77">{</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2">            </span></span><span style="--0:#F8F8F2;--1:#575279;--1fs:italic">$todos</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#FF79C6;--1:#286983">|</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--1:#286983">append</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#625F77">{</span><span style="--0:#F8F8F2;--1:#575279;--1fs:italic">id</span><span style="--0:#FF79C6;--1:#286983">:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#575279;--1fs:italic">$frame.id</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#575279;--1fs:italic">text</span><span style="--0:#FF79C6;--1:#286983">:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#575279;--1fs:italic">$frame.meta.text</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#575279;--1fs:italic">completed</span><span style="--0:#FF79C6;--1:#286983">:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#8A5351">false</span><span style="--0:#F8F8F2;--1:#625F77">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#FF79C6;--1:#286983">|</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#625F77">{</span><span style="--0:#F8F8F2;--1:#575279;--1fs:italic">out</span><span style="--0:#FF79C6;--1:#286983">:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#575279;--1fs:italic">$in</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#575279;--1fs:italic">next</span><span style="--0:#FF79C6;--1:#286983">:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#575279;--1fs:italic">$in</span><span style="--0:#F8F8F2;--1:#625F77">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2">          </span></span><span style="--0:#F8F8F2;--1:#625F77">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--1:#855A1E"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">toggle</span><span style="--0:#E9F284">"</span></span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">=></span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#625F77">{</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2">            </span></span><span style="--0:#F8F8F2;--1:#575279;--1fs:italic">$todos</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--1:#286983">|</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--1:#286983">each</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#625F77">{</span><span style="--0:#F8F8F2;--1:#575279">|</span><span style="--0:#FFB86C;--0fs:italic;--1:#6C5C7F;--1fs:italic">todo</span><span style="--0:#F8F8F2;--1:#575279">|</span></div></div><div class="ec-line"><div class="code"><span class="indent">              </span><span style="--0:#FF79C6;--1:#286983">if</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#575279;--1fs:italic">$todo.id</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--1:#286983">==</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#575279;--1fs:italic">$frame.meta.id</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#625F77">{</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2">                </span></span><span style="--0:#F8F8F2;--1:#625F77">{</span><span style="--0:#F8F8F2;--1:#575279;--1fs:italic">id</span><span style="--0:#FF79C6;--1:#286983">:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#575279;--1fs:italic">$todo.id</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#575279;--1fs:italic">text</span><span style="--0:#FF79C6;--1:#286983">:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#575279;--1fs:italic">$todo.text</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#575279;--1fs:italic">completed</span><span style="--0:#FF79C6;--1:#286983">:</span><span style="--0:#F8F8F2;--1:#575279"> (</span><span style="--0:#FF79C6;--1:#286983">not</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#575279;--1fs:italic">$todo.completed</span><span style="--0:#F8F8F2;--1:#575279">)</span><span style="--0:#F8F8F2;--1:#625F77">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2">              </span></span><span style="--0:#F8F8F2;--1:#625F77">}</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--1:#286983">else</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#625F77">{</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#575279;--1fs:italic">$todo</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#625F77">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2">            </span></span><span style="--0:#F8F8F2;--1:#625F77">}</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--1:#286983">|</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#625F77">{</span><span style="--0:#F8F8F2;--1:#575279;--1fs:italic">out</span><span style="--0:#FF79C6;--1:#286983">:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#575279;--1fs:italic">$in</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#575279;--1fs:italic">next</span><span style="--0:#FF79C6;--1:#286983">:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#575279;--1fs:italic">$in</span><span style="--0:#F8F8F2;--1:#625F77">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2">          </span></span><span style="--0:#F8F8F2;--1:#625F77">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#8BE9FD;--0fs:italic;--1:#3D6971">_</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">=></span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#625F77">{</span><span style="--0:#F8F8F2;--1:#575279;--1fs:italic">next</span><span style="--0:#FF79C6;--1:#286983">:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#575279;--1fs:italic">$todos</span><span style="--0:#F8F8F2;--1:#625F77">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2">        </span></span><span style="--0:#F8F8F2;--1:#625F77">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2">      </span></span><span style="--0:#F8F8F2;--1:#625F77">}</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--1:#286983">|</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--1:#286983">each</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#625F77">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#FF79C6;--1:#286983">let</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#575279;--1fs:italic">html</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--1:#286983">=</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#625F77">{</span><span style="--0:#F8F8F2;--1:#575279;--1fs:italic">todos</span><span style="--0:#FF79C6;--1:#286983">:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#575279;--1fs:italic">$in</span><span style="--0:#F8F8F2;--1:#625F77">}</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--1:#286983">|</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--1:#286983">to json</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--0fs:italic;--1:#286983;--1fs:italic">-</span><span style="--0:#FFB86C;--0fs:italic;--1:#6C5C7F;--1fs:italic">r</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--1:#286983">|</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#8BE9FD;--0fs:italic;--1:#3D6971">minijinja-cli</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--0fs:italic;--1:#286983;--1fs:italic">-</span><span style="--0:#FFB86C;--0fs:italic;--1:#6C5C7F;--1fs:italic">f</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">json</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">todo_template.html</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--1:#286983">-</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#FF79C6;--1:#286983">let</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#575279;--1fs:italic">sse_data</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--1:#286983">=</span><span style="--0:#F8F8F2;--1:#575279"> (</span><span style="--0:#F8F8F2;--1:#575279;--1fs:italic">$html</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--1:#286983">|</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--1:#286983">lines</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--1:#286983">|</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--1:#286983">each</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#625F77">{</span><span style="--0:#F8F8F2;--1:#575279">|</span><span style="--0:#FFB86C;--0fs:italic;--1:#6C5C7F;--1fs:italic">line</span><span style="--0:#F8F8F2;--1:#575279">| </span><span style="--1:#855A1E"><span style="--0:#E9F284">$"</span><span style="--0:#F1FA8C">data: elements </span></span><span style="--0:#F8F8F2;--1:#575279">(</span><span style="--0:#F8F8F2;--1:#575279;--1fs:italic">$line</span><span style="--0:#F8F8F2;--1:#575279">)</span><span style="--0:#E9F284;--1:#855A1E">"</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#625F77">}</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--1:#286983">|</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--1:#286983">str join</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#E9F284;--1:#855A1E">"</span><span style="--0:#FF79C6;--1:#286983">\n</span><span style="--0:#E9F284;--1:#855A1E">"</span><span style="--0:#F8F8F2;--1:#575279">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--1:#855A1E"><span style="--0:#E9F284">$"</span><span style="--0:#F1FA8C">event: datastar-patch-elements</span></span><span style="--0:#FF79C6;--1:#286983">\n</span><span style="--0:#F8F8F2;--1:#575279">(</span><span style="--0:#F8F8F2;--1:#575279;--1fs:italic">$sse_data</span><span style="--0:#F8F8F2;--1:#575279">)</span><span style="--0:#FF79C6;--1:#286983">\n\n</span><span style="--0:#E9F284;--1:#855A1E">"</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2">      </span></span><span style="--0:#F8F8F2;--1:#625F77">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2">    </span></span><span style="--0:#F8F8F2;--1:#625F77">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#8BE9FD;--0fs:italic;--1:#3D6971">_</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">=></span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#625F77">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#8BE9FD;--0fs:italic;--1:#3D6971">.response</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#625F77">{</span><span style="--0:#F8F8F2;--1:#575279;--1fs:italic">status</span><span style="--0:#FF79C6;--1:#286983">:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#8A5351">404</span><span style="--0:#F8F8F2;--1:#625F77">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--1:#855A1E"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">Not Found</span><span style="--0:#E9F284">"</span></span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2">    </span></span><span style="--0:#F8F8F2;--1:#625F77">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2">  </span></span><span style="--0:#F8F8F2;--1:#625F77">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#625F77">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="use ~/.config/nushell/modules/xs.nu *{|req|  match $req {    {method: &#x22;GET&#x22;, path: &#x22;/&#x22;} => {      .static &#x22;.&#x22; &#x22;index.html&#x22;    }    {method: &#x22;GET&#x22;, path: &#x22;/updates&#x22;} => {      .response {headers: {        &#x22;content-type&#x22;: &#x22;text/event-stream&#x22;,        &#x22;cache-control&#x22;: &#x22;no-cache&#x22;,        &#x22;access-control-allow-origin&#x22;: &#x22;*&#x22;      }}      .cat -f | where topic == &#x22;todos&#x22; | generate {|frame, todos = []|        match $frame.meta.action {          &#x22;add&#x22; => {            $todos            | append {id: $frame.id text: $frame.meta.text completed: false}            | {out: $in next: $in}          }          &#x22;toggle&#x22; => {            $todos | each {|todo|              if $todo.id == $frame.meta.id {                {id: $todo.id text: $todo.text completed: (not $todo.completed)}              } else { $todo }            } | {out: $in next: $in}          }          _ => {next: $todos}        }      } | each {        let html = {todos: $in} | to json -r | minijinja-cli -f json todo_template.html -        let sse_data = ($html | lines | each {|line| $&#x22;data: elements ($line)&#x22; } | str join &#x22;\n&#x22;)        $&#x22;event: datastar-patch-elements\n($sse_data)\n\n&#x22;      }    }    _ => {      .response {status: 404}      &#x22;Not Found&#x22;    }  }}"><div></div></button></div></figure></div>
<p>Run the server:</p>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span style="--0:#50FA7B;--1:#8A5351">cat</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">serve.nu</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--1:#286983">|</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#50FA7B;--1:#8A5351">http-nu</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">:3001</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">-</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="cat serve.nu | http-nu :3001 -"><div></div></button></div></figure></div>
<p>Test the SSE endpoint with curl:</p>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span style="--0:#50FA7B;--1:#8A5351">curl</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#286983">-sN</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">http://localhost:3001/updates</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="curl -sN http://localhost:3001/updates"><div></div></button></div></figure></div>
<p>You’ll see HTML fragments streaming in Datastar’s SSE format as events flow through the todos stream.</p>
<h2 id="finally-a-little-datastar">Finally, a little Datastar</h2>
<p><img src="/xs/_astro/datastar.DZ4P2kzC_Z1miElW.webp" alt="Datastar TodoMVC Demo" loading="lazy" decoding="async" fetchpriority="auto" width="24" height="24"></p>
<p>Create an <code dir="auto">index.html</code> that uses Datastar for reactive updates:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="html"><code><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#64606C">&#x3C;!</span><span style="--0:#FF79C6;--1:#3D6971">DOCTYPE</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#50FA7B;--0fs:italic;--1:#6C5C7F;--1fs:italic">html</span><span style="--0:#F8F8F2;--1:#64606C">></span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#64606C">&#x3C;</span><span style="--0:#FF79C6;--1:#3D6971">html</span><span style="--0:#F8F8F2;--1:#64606C">></span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2">  </span></span><span style="--0:#F8F8F2;--1:#64606C">&#x3C;</span><span style="--0:#FF79C6;--1:#3D6971">head</span><span style="--0:#F8F8F2;--1:#64606C">></span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2">    </span></span><span style="--0:#F8F8F2;--1:#64606C">&#x3C;</span><span style="--0:#FF79C6;--1:#3D6971">title</span><span style="--0:#F8F8F2;--1:#64606C">></span><span style="--0:#F8F8F2;--1:#575279">TodoMVC with Datastar</span><span style="--0:#F8F8F2;--1:#64606C">&#x3C;/</span><span style="--0:#FF79C6;--1:#3D6971">title</span><span style="--0:#F8F8F2;--1:#64606C">></span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2">    </span></span><span style="--0:#F8F8F2;--1:#64606C">&#x3C;</span><span style="--0:#FF79C6;--1:#3D6971">script</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#50FA7B;--0fs:italic;--1:#6C5C7F;--1fs:italic">type</span><span style="--0:#FF79C6;--1:#625F77">=</span><span style="--1:#855A1E"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">module</span><span style="--0:#E9F284">"</span></span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#50FA7B;--0fs:italic;--1:#6C5C7F;--1fs:italic">src</span><span style="--0:#FF79C6;--1:#625F77">=</span><span style="--1:#855A1E"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">https://cdn.jsdelivr.net/gh/starfederation/datastar@main/bundles/datastar.js</span><span style="--0:#E9F284">"</span></span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2">    </span></span><span style="--0:#F8F8F2;--1:#64606C">>&#x3C;/</span><span style="--0:#FF79C6;--1:#3D6971">script</span><span style="--0:#F8F8F2;--1:#64606C">></span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2">  </span></span><span style="--0:#F8F8F2;--1:#64606C">&#x3C;/</span><span style="--0:#FF79C6;--1:#3D6971">head</span><span style="--0:#F8F8F2;--1:#64606C">></span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2">  </span></span><span style="--0:#F8F8F2;--1:#64606C">&#x3C;</span><span style="--0:#FF79C6;--1:#3D6971">body</span><span style="--0:#F8F8F2;--1:#64606C">></span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2">    </span></span><span style="--0:#F8F8F2;--1:#64606C">&#x3C;</span><span style="--0:#FF79C6;--1:#3D6971">h1</span><span style="--0:#F8F8F2;--1:#64606C">></span><span style="--0:#F8F8F2;--1:#575279">TodoMVC with Datastar</span><span style="--0:#F8F8F2;--1:#64606C">&#x3C;/</span><span style="--0:#FF79C6;--1:#3D6971">h1</span><span style="--0:#F8F8F2;--1:#64606C">></span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2">    </span></span><span style="--0:#F8F8F2;--1:#64606C">&#x3C;</span><span style="--0:#FF79C6;--1:#3D6971">ul</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#50FA7B;--0fs:italic;--1:#6C5C7F;--1fs:italic">id</span><span style="--0:#FF79C6;--1:#625F77">=</span><span style="--1:#855A1E"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">todos</span><span style="--0:#E9F284">"</span></span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#50FA7B;--0fs:italic;--1:#6C5C7F;--1fs:italic">data-on-load</span><span style="--0:#FF79C6;--1:#625F77">=</span><span style="--1:#855A1E"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">@get('/updates')</span><span style="--0:#E9F284">"</span></span><span style="--0:#F8F8F2;--1:#64606C">></span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2">      </span></span><span style="--0:#F8F8F2;--1:#64606C">&#x3C;</span><span style="--0:#FF79C6;--1:#3D6971">li</span><span style="--0:#F8F8F2;--1:#64606C">></span><span style="--0:#F8F8F2;--1:#575279">Loading todos...</span><span style="--0:#F8F8F2;--1:#64606C">&#x3C;/</span><span style="--0:#FF79C6;--1:#3D6971">li</span><span style="--0:#F8F8F2;--1:#64606C">></span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2">    </span></span><span style="--0:#F8F8F2;--1:#64606C">&#x3C;/</span><span style="--0:#FF79C6;--1:#3D6971">ul</span><span style="--0:#F8F8F2;--1:#64606C">></span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2">  </span></span><span style="--0:#F8F8F2;--1:#64606C">&#x3C;/</span><span style="--0:#FF79C6;--1:#3D6971">body</span><span style="--0:#F8F8F2;--1:#64606C">></span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#64606C">&#x3C;/</span><span style="--0:#FF79C6;--1:#3D6971">html</span><span style="--0:#F8F8F2;--1:#64606C">></span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="<!DOCTYPE html><html>  <head>    <title>TodoMVC with Datastar</title>    <script      type=&#x22;module&#x22;      src=&#x22;https://cdn.jsdelivr.net/gh/starfederation/datastar@main/bundles/datastar.js&#x22;    ></script>  </head>  <body>    <h1>TodoMVC with Datastar</h1>    <ul id=&#x22;todos&#x22; data-on-load=&#x22;@get(&#x27;/updates&#x27;)&#x22;>      <li>Loading todos...</li>    </ul>  </body></html>"><div></div></button></div></figure></div>
<p>When the <code dir="auto">#todos</code> element loads, <a href="https://data-star.dev/reference/attributes#data-on-load"><code dir="auto">data-on-load</code></a> executes the <a href="https://data-star.dev/reference/actions#get"><code dir="auto">@get</code></a> action to connect to our <code dir="auto">/updates</code> Server-Sent Events endpoint. Datastar receives the streamed HTML fragments and replaces the <code dir="auto">#todos</code> element whenever the todo state changes.</p>
<p>Visit <a href="http://localhost:3001">http://localhost:3001</a> and then in your terminal try appending some more events:</p>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span style="--0:#50FA7B;--1:#8A5351">.append</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">todos</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#286983">--meta</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">{action:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--1:#855A1E"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">add</span><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">,</span></span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">text:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--1:#855A1E"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">Learn datastar</span><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">}</span></span></div></div><div class="ec-line"><div class="code"><span style="--0:#8BE9FD;--1:#8F4F61;--1fs:italic">let</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">todo</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">=</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">.head</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">todos</span></div></div><div class="ec-line"><div class="code"><span style="--0:#50FA7B;--1:#8A5351">.append</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">todos</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#286983">--meta</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">{action:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--1:#855A1E"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">toggle</span><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">,</span></span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">id:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#575279;--1fs:italic">$todo</span><span style="--0:#F1FA8C;--1:#855A1E">.id}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code=".append todos --meta {action: &#x22;add&#x22;, text: &#x22;Learn datastar&#x22;}let todo = .head todos.append todos --meta {action: &#x22;toggle&#x22;, id: $todo.id}"><div></div></button></div></figure></div>
<p>Watch as each event immediately updates the web interface - this is hypermedia-driven reactive programming in action!</p>
<h2 id="complete-the-ui-loop">Complete the UI Loop</h2>
<p>Let’s add an input field so users can add todos directly from the web interface. First, update the <code dir="auto">index.html</code> to include an input field:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="html"><code><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#64606C">&#x3C;</span><span style="--0:#FF79C6;--1:#3D6971">body</span><span style="--0:#F8F8F2;--1:#64606C">></span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2">  </span></span><span style="--0:#F8F8F2;--1:#64606C">&#x3C;</span><span style="--0:#FF79C6;--1:#3D6971">h1</span><span style="--0:#F8F8F2;--1:#64606C">></span><span style="--0:#F8F8F2;--1:#575279">TodoMVC with Datastar</span><span style="--0:#F8F8F2;--1:#64606C">&#x3C;/</span><span style="--0:#FF79C6;--1:#3D6971">h1</span><span style="--0:#F8F8F2;--1:#64606C">></span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2">  </span></span><span style="--0:#F8F8F2;--1:#64606C">&#x3C;</span><span style="--0:#FF79C6;--1:#3D6971">input</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#50FA7B;--0fs:italic;--1:#6C5C7F;--1fs:italic">type</span><span style="--0:#FF79C6;--1:#625F77">=</span><span style="--1:#855A1E"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">text</span><span style="--0:#E9F284">"</span></span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#50FA7B;--0fs:italic;--1:#6C5C7F;--1fs:italic">placeholder</span><span style="--0:#FF79C6;--1:#625F77">=</span><span style="--1:#855A1E"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">What needs to be done?</span><span style="--0:#E9F284">"</span></span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#50FA7B;--0fs:italic;--1:#6C5C7F;--1fs:italic">data-signals-input</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#50FA7B;--0fs:italic;--1:#6C5C7F;--1fs:italic">data-bind-input</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#50FA7B;--0fs:italic;--1:#6C5C7F;--1fs:italic">data-on-keydown</span><span style="--0:#FF79C6;--1:#625F77">=</span><span style="--0:#E9F284;--1:#855A1E">"</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F1FA8C;--1:#855A1E">      </span></span><span style="--0:#F1FA8C;--1:#855A1E">evt.key === 'Enter' &#x26;&#x26; $input.trim() &#x26;&#x26; @post('/add') &#x26;&#x26; ($input = '');</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#855A1E">    </span></span><span style="--0:#E9F284;--1:#855A1E">"</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2">  </span></span><span style="--0:#F8F8F2;--1:#64606C">/></span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2">  </span></span><span style="--0:#F8F8F2;--1:#64606C">&#x3C;</span><span style="--0:#FF79C6;--1:#3D6971">ul</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#50FA7B;--0fs:italic;--1:#6C5C7F;--1fs:italic">id</span><span style="--0:#FF79C6;--1:#625F77">=</span><span style="--1:#855A1E"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">todos</span><span style="--0:#E9F284">"</span></span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#50FA7B;--0fs:italic;--1:#6C5C7F;--1fs:italic">data-on-load</span><span style="--0:#FF79C6;--1:#625F77">=</span><span style="--1:#855A1E"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">@get('/updates')</span><span style="--0:#E9F284">"</span></span><span style="--0:#F8F8F2;--1:#64606C">></span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2">    </span></span><span style="--0:#F8F8F2;--1:#64606C">&#x3C;</span><span style="--0:#FF79C6;--1:#3D6971">li</span><span style="--0:#F8F8F2;--1:#64606C">></span><span style="--0:#F8F8F2;--1:#575279">Loading todos...</span><span style="--0:#F8F8F2;--1:#64606C">&#x3C;/</span><span style="--0:#FF79C6;--1:#3D6971">li</span><span style="--0:#F8F8F2;--1:#64606C">></span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2">  </span></span><span style="--0:#F8F8F2;--1:#64606C">&#x3C;/</span><span style="--0:#FF79C6;--1:#3D6971">ul</span><span style="--0:#F8F8F2;--1:#64606C">></span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#64606C">&#x3C;/</span><span style="--0:#FF79C6;--1:#3D6971">body</span><span style="--0:#F8F8F2;--1:#64606C">></span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="<body>  <h1>TodoMVC with Datastar</h1>  <input    type=&#x22;text&#x22;    placeholder=&#x22;What needs to be done?&#x22;    data-signals-input    data-bind-input    data-on-keydown=&#x22;      evt.key === &#x27;Enter&#x27; &#x26;&#x26; $input.trim() &#x26;&#x26; @post(&#x27;/add&#x27;) &#x26;&#x26; ($input = &#x27;&#x27;);    &#x22;  />  <ul id=&#x22;todos&#x22; data-on-load=&#x22;@get(&#x27;/updates&#x27;)&#x22;>    <li>Loading todos...</li>  </ul></body>"><div></div></button></div></figure></div>
<p>The input uses <a href="https://data-star.dev/reference/attributes#data-signals-input"><code dir="auto">data-signals-input</code></a> to create a <code dir="auto">$input</code> signal, <a href="https://data-star.dev/reference/attributes#data-bind-input"><code dir="auto">data-bind-input</code></a> to sync the field value with the signal, and <a href="https://data-star.dev/reference/attributes#data-on-keydown"><code dir="auto">data-on-keydown</code></a> to POST the todo text to our <code dir="auto">/add</code> endpoint when Enter is pressed, then clear the input field.</p>
<p>Now add the <code dir="auto">/add</code> endpoint to your <code dir="auto">serve.nu</code> by adding this case to the match block (you’ll need to restart http-nu after updating the file):</p>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="nushell"><code><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#625F77">{</span><span style="--0:#F8F8F2;--1:#575279;--1fs:italic">method</span><span style="--0:#FF79C6;--1:#286983">:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--1:#855A1E"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">POST</span><span style="--0:#E9F284">"</span></span><span style="--0:#F8F8F2;--1:#575279">, </span><span style="--0:#F8F8F2;--1:#575279;--1fs:italic">path</span><span style="--0:#FF79C6;--1:#286983">:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--1:#855A1E"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">/add</span><span style="--0:#E9F284">"</span></span><span style="--0:#F8F8F2;--1:#625F77">}</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">=></span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#625F77">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FF79C6;--1:#286983">let</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#575279;--1fs:italic">text</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--1:#286983">=</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#575279;--1fs:italic">$in</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--1:#286983">|</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--1:#286983">from json</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--1:#286983">|</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--1:#286983">get</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">input</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--1:#286983">|</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--1:#286983">str trim</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#8BE9FD;--0fs:italic;--1:#3D6971">.response</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#625F77">{</span><span style="--0:#F8F8F2;--1:#575279;--1fs:italic">status</span><span style="--0:#FF79C6;--1:#286983">:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#BD93F9;--1:#8A5351">204</span><span style="--0:#F8F8F2;--1:#625F77">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#8BE9FD;--0fs:italic;--1:#3D6971">.append</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F1FA8C;--1:#855A1E">todos</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--0fs:italic;--1:#286983;--1fs:italic">--</span><span style="--0:#FFB86C;--0fs:italic;--1:#6C5C7F;--1fs:italic">meta</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#625F77">{</span><span style="--0:#F8F8F2;--1:#575279;--1fs:italic">action</span><span style="--0:#FF79C6;--1:#286983">:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--1:#855A1E"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">add</span><span style="--0:#E9F284">"</span></span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#575279;--1fs:italic">text</span><span style="--0:#FF79C6;--1:#286983">:</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#F8F8F2;--1:#575279;--1fs:italic">$text</span><span style="--0:#F8F8F2;--1:#625F77">}</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--1:#286983">|</span><span style="--0:#F8F8F2;--1:#575279"> </span><span style="--0:#FF79C6;--1:#286983">ignore</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#625F77">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="{method: &#x22;POST&#x22;, path: &#x22;/add&#x22;} => {  let text = $in | from json | get input | str trim  .response {status: 204}  .append todos --meta {action: &#x22;add&#x22; text: $text} | ignore}"><div></div></button></div></figure></div>
<p>This endpoint parses the JSON body to extract the <code dir="auto">input</code> field (Datastar sends <code dir="auto">{"input": "todo text"}</code>), appends a new todo event to the stream, and returns status 204.</p>
<p>Now the reactive loop is complete. When users type a todo and press Enter:</p>
<ol>
<li><strong>Browser</strong> → POST to <code dir="auto">/add</code> endpoint with the todo text</li>
<li><strong>Server</strong> → <code dir="auto">.append todos --meta {action: "add" text: $text}</code> creates a new event in the stream</li>
<li><strong>SSE endpoint</strong> → <code dir="auto">/updates</code> detects the new event via <code dir="auto">.cat -f | where topic == "todos"</code></li>
<li><strong>Stream processing</strong> → Generate command aggregates the new state and renders HTML</li>
<li><strong>Browser update</strong> → Datastar receives the SSE event and updates the <code dir="auto">#todos</code> element</li>
</ol>
<p>All connected browsers update simultaneously because they’re all listening to the same <code dir="auto">/updates</code> SSE stream.</p> </div> <footer class="sl-flex astro-3yyafb3n"> <div class="meta sl-flex astro-3yyafb3n">   </div> <div class="pagination-links astro-u2l5gyhi" dir="ltr"> <a href="/xs/tutorials/mcp-integration/" rel="prev" class="astro-u2l5gyhi"> <svg aria-hidden="true" class="astro-u2l5gyhi astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.5rem;"><path d="M17 11H9.41l3.3-3.29a1.004 1.004 0 1 0-1.42-1.42l-5 5a1 1 0 0 0-.21.33 1 1 0 0 0 0 .76 1 1 0 0 0 .21.33l5 5a1.002 1.002 0 0 0 1.639-.325 1 1 0 0 0-.219-1.095L9.41 13H17a1 1 0 0 0 0-2Z"/></svg>  <span class="astro-u2l5gyhi"> Previous <br class="astro-u2l5gyhi"> <span class="link-title astro-u2l5gyhi">Integrating MCP Servers</span> </span> </a> <a href="/xs/reference/cli/" rel="next" class="astro-u2l5gyhi"> <svg aria-hidden="true" class="astro-u2l5gyhi astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.5rem;"><path d="M17.92 11.62a1.001 1.001 0 0 0-.21-.33l-5-5a1.003 1.003 0 1 0-1.42 1.42l3.3 3.29H7a1 1 0 0 0 0 2h7.59l-3.3 3.29a1.002 1.002 0 0 0 .325 1.639 1 1 0 0 0 1.095-.219l5-5a1 1 0 0 0 .21-.33 1 1 0 0 0 0-.76Z"/></svg>  <span class="astro-u2l5gyhi"> Next <br class="astro-u2l5gyhi"> <span class="link-title astro-u2l5gyhi">cli</span> </span> </a> </div>  <a class="kudos sl-flex astro-3yyafb3n" href="https://starlight.astro.build"> <svg aria-hidden="true" class="astro-3yyafb3n astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path fill-rule="evenodd" d="M15.19 6.75 12 0 8.81 6.75l-.19.38-1.68-1.88a1.2 1.2 0 1 0-1.69 1.69L7.13 8.8h-.38L0 12l6.75 3.19h.38l-1.88 1.87a1.2 1.2 0 1 0 1.69 1.69l1.68-1.88.2.38L12 24l3.19-6.75v-.38l1.69 1.88a1.2 1.2 0 1 0 1.68-1.69l-1.68-1.68.37-.2L24 12l-6.75-3.19-.38-.19 1.7-1.68a1.2 1.2 0 1 0-1.7-1.69L15.2 7.13v-.38ZM12 7.13l-.38.93a8.18 8.18 0 0 1-3.56 3.56l-.94.38.94.38a8.18 8.18 0 0 1 3.56 3.56l.38.94.38-.94a8.18 8.18 0 0 1 3.56-3.56l.94-.38-.94-.38a8.18 8.18 0 0 1-3.56-3.56L12 7.12Z"/><path d="M22.12 3.56a1.2 1.2 0 1 0-1.68-1.69l-.57.57a1.2 1.2 0 0 0 1.7 1.68l.55-.56Zm-18 .75c-.37.38-1.12.38-1.68 0l-.57-.56a1.2 1.2 0 0 1 1.7-1.69l.55.56c.57.38.57 1.13 0 1.7Zm0 15.38c-.37-.38-1.12-.38-1.68 0l-.57.56a1.2 1.2 0 1 0 1.7 1.69l.55-.57c.57-.37.57-1.12 0-1.68Zm18 .75a1.2 1.2 0 1 1-1.68 1.68l-.57-.56a1.2 1.2 0 0 1 1.7-1.69l.55.57Z"/></svg>  Built with Starlight </a> </footer>  </div> </div>   </main> </div> </div>  </div> </div>  </body></html>